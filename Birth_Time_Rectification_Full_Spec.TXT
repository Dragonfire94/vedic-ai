# ë² ë”• ì ì„±í•™ ìƒì‹œë³´ì • ì—”ì§„
# í’€ ìŠ¤í™ ê¸°ìˆ  ì„¤ê³„ì„œ

> **ì‘ì„±ì¼**: 2026-02-09
> **ë¬¸ì„œ íƒ€ì…**: í†µí•© ë§ˆìŠ¤í„° ë¬¸ì„œ (Full Specification)

---

## ëª©ì°¨

0. [ë¬¸ì„œ ê°œìš”](#0-ë¬¸ì„œ-ê°œìš”)
1. [ì£¼ìš” ë³€ê²½ ì‚¬í•­ ìš”ì•½](#1-ì£¼ìš”-ë³€ê²½-ì‚¬í•­-ìš”ì•½)
2. [ì‹œìŠ¤í…œ ì² í•™](#2-ì‹œìŠ¤í…œ-ì² í•™)
3. [ì ì„±í•™ ëª¨ë¸ êµ¬ì¡°](#3-ì ì„±í•™-ëª¨ë¸-êµ¬ì¡°)
4. [ì—”ì§„ ì•„í‚¤í…ì²˜](#4-ì—”ì§„-ì•„í‚¤í…ì²˜)
5. [ì‹œê°„ í‘œë³¸ ìƒì„±](#5-ì‹œê°„-í‘œë³¸-ìƒì„±)
6. [ì§ˆë¬¸ ì‹œìŠ¤í…œ](#6-ì§ˆë¬¸-ì‹œìŠ¤í…œ)
7. [Feature Mapping](#7-feature-mapping)
8. [ìŠ¤ì½”ì–´ë§ ì‹œìŠ¤í…œ](#8-ìŠ¤ì½”ì–´ë§-ì‹œìŠ¤í…œ)
9. [ì‚¬ê±´ ê²€ì¦ ì‹œìŠ¤í…œ](#9-ì‚¬ê±´-ê²€ì¦-ì‹œìŠ¤í…œ)
10. [ë„ìˆ˜ ì¶”ì • ë° Cusp ì²˜ë¦¬](#10-ë„ìˆ˜-ì¶”ì •-ë°-cusp-ì²˜ë¦¬)
11. [ì‹ ë¢°ë„ ë“±ê¸‰ ì‹œìŠ¤í…œ](#11-ì‹ ë¢°ë„-ë“±ê¸‰-ì‹œìŠ¤í…œ)
12. [UX í”Œë¡œìš°](#12-ux-í”Œë¡œìš°)
13. [ë¡œê¹… ì‹œìŠ¤í…œ](#13-ë¡œê¹…-ì‹œìŠ¤í…œ)
14. [FactoryData êµ¬ì¡°](#14-factorydata-êµ¬ì¡°)
15. [ìš©ì–´ ì‚¬ì „](#15-ìš©ì–´-ì‚¬ì „)
16. [Phase ë¡œë“œë§µ](#16-phase-ë¡œë“œë§µ)
17. [ì„±ëŠ¥ ìµœì í™”](#17-ì„±ëŠ¥-ìµœì í™”)
18. [Phase 3 ì¤€ë¹„ì‚¬í•­](#18-phase-3-ì¤€ë¹„ì‚¬í•­)
19. [Breaking Changes ë° ë§ˆì´ê·¸ë ˆì´ì…˜](#19-breaking-changes-ë°-ë§ˆì´ê·¸ë ˆì´ì…˜)
20. [ê°œë°œíŒ€ ì „ë‹¬ì‚¬í•­](#20-ê°œë°œíŒ€-ì „ë‹¬ì‚¬í•­)
21. [êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸](#21-êµ¬í˜„-ì²´í¬ë¦¬ìŠ¤íŠ¸)
22. [í…ŒìŠ¤íŠ¸ ì „ëµ](#22-í…ŒìŠ¤íŠ¸-ì „ëµ)
23. [ë³´ì•ˆ ë° ê°œì¸ì •ë³´ ë³´í˜¸](#23-ë³´ì•ˆ-ë°-ê°œì¸ì •ë³´-ë³´í˜¸)
24. [ë¶€ë¡](#24-ë¶€ë¡)

---

## 0. ë¬¸ì„œ ê°œìš”

### 0.1 ë¬¸ì„œ ì„±ê²©

ì´ ë¬¸ì„œëŠ” **ìƒìš© ë² ë”• ì ì„±í•™ ìƒì‹œë³´ì • ì—”ì§„ì˜ ì „ì²´ ê¸°ìˆ  ì„¤ê³„ì„œ**ë‹¤.

> ğŸ‘‰ **ì œí’ˆ ì•„í‚¤í…ì²˜ + ì•Œê³ ë¦¬ì¦˜ ì„¤ê³„ + ë°ì´í„° êµ¬ì¡° + UX ì„¤ê³„**ë¥¼ í¬í•¨í•˜ëŠ” **ì—”ì§„ ë°±ì„œ**ë‹¤.

**ëŒ€ìƒ ë…ì**:
- ì´ì±…ì„ ê°œë°œì
- ì—”ì§„ êµ¬í˜„ íŒ€
- í–¥í›„ ML ì—”ì§€ë‹ˆì–´
- QA ì—”ì§€ë‹ˆì–´
- ì ì„±í•™ ì „ë¬¸ê°€

### 0.2 ë¬¸ì„œ í™œìš© ê°€ì´ë“œ (ì—­í• ë³„)

**ì´ì±…ì„ ê°œë°œì**:
- Section 0(ë¬¸ì„œ ê°œìš”), Section 20(ê°œë°œíŒ€ ì „ë‹¬ì‚¬í•­), Section 21(ì²´í¬ë¦¬ìŠ¤íŠ¸)
- Breaking Changes(Section 19), ì „ì²´ ì•„í‚¤í…ì²˜(Section 4)
- Phase ë¡œë“œë§µ(Section 16)

**ë°±ì—”ë“œ ì—”ì§€ë‹ˆì–´**:
- ìŠ¤ì½”ì–´ë§ ì‹œìŠ¤í…œ(Section 8), ì‚¬ê±´ ê²€ì¦(Section 9), ë„ìˆ˜ ì¶”ì •(Section 10)
- ë¡œê·¸ í•¨ìˆ˜ Base ëª…ì‹œ(Section 8.1), Event Rules JSON ìŠ¤í‚¤ë§ˆ(Section 9.1)
- Fallback ì‹œìŠ¤í…œ(Section 9.4)

**í”„ë¡ íŠ¸ì—”ë“œ ì—”ì§€ë‹ˆì–´**:
- UX í”Œë¡œìš°(Section 12), ì§ˆë¬¸ ì‹œìŠ¤í…œ(Section 6), GDPR ë™ì˜ í”Œë¡œìš°(Section 12.2)

**ë°ì´í„° ì—”ì§€ë‹ˆì–´**:
- FactoryData êµ¬ì¡°(Section 14), Event Rules JSON(Section 9.1), ì„¸ì…˜ ë¡œê·¸(Section 13.1)
- ê¸ˆì§€ í•„ë“œ ëª©ë¡ ë° ìë™ ê²€ì¦ ë¡œì§(Section 23)

**QA ì—”ì§€ë‹ˆì–´**:
- í…ŒìŠ¤íŠ¸ ì „ëµ(Section 22), ë²¤ì¹˜ë§ˆí¬ ìŠ¤í¬ë¦½íŠ¸(Section 18.4)
- í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ í™•ì¥(Section 22.3)

**ML ì—”ì§€ë‹ˆì–´**:
- Phase 3 ì¤€ë¹„ì‚¬í•­(Section 18 ì „ì²´)
- ml_trainable í•„ë“œ(Section 9.1), weight_range(Section 18.2)
- Fallback ë¡œê·¸ í™œìš©(Section 18.5)

**ì ì„±í•™ ì „ë¬¸ê°€**:
- ì§ˆë¬¸ ì‹œìŠ¤í…œ(Section 6), Feature Mapping(Section 7), ìš©ì–´ ì‚¬ì „(Section 15)

---

## 1. ì£¼ìš” ë³€ê²½ ì‚¬í•­ ìš”ì•½

### Quick Delta Overview

ì´ ì„¹ì…˜ì€ ìµœì‹  ì„¤ê³„ì˜ í•µì‹¬ ê°œì„  ì‚¬í•­ì„ ìš”ì•½í•œë‹¤.

#### 1.1 ë¡œê·¸ í•¨ìˆ˜ ëª…ì‹œí™”

**ë³€ê²½ ì „**: ëª¨í˜¸í•œ `log()` í‘œê¸°
**ë³€ê²½ í›„**: ìì—°ë¡œê·¸ `ln()` ëª…ì‹œ + ì„ íƒ ì´ìœ  ìƒì„¸ ì„¤ëª…

**ln ì„ íƒ ì´ìœ ** (vs log10 ë¹„êµ):
- **Gradient ì•ˆì •ì„±**: ln(x)ì˜ ë¯¸ë¶„ = 1/x (ê¹”ë”), log10(x)ì˜ ë¯¸ë¶„ = 1/(xÂ·ln(10)) (ë¶ˆí•„ìš”í•œ ìƒìˆ˜)
- **ML í”„ë ˆì„ì›Œí¬ í‘œì¤€**: PyTorch, TensorFlow ëª¨ë‘ ìì—°ë¡œê·¸ ê¸°ë³¸ ì‚¬ìš©
- **Softmax ìµœì í™”**: exp(ln(x)) = x ìˆ˜ì¹˜ ì•ˆì •ì„± ë³´ì¥
- **Phase 3 ì¤€ë¹„**: ML ì „í™˜ ì‹œ ì½”ë“œ í˜¸í™˜ì„± ë¬¸ì œ ì—†ìŒ

#### 1.2 Event Rules JSONí™”

**ë³€ê²½ ì „**: ì½”ë“œì— í•˜ë“œì½”ë”©ëœ ì‚¬ê±´ ê·œì¹™
**ë³€ê²½ í›„**: JSON ë°ì´í„° ê¸°ë°˜ + ml_trainable í•„ë“œ

**ì‹ ê·œ í•„ë“œ**:
- `ml_trainable`: Phase 3ì—ì„œ í•™ìŠµí•  íŒŒë¼ë¯¸í„° í”Œë˜ê·¸
- `weight_range`: [min, max] ê°€ì¤‘ì¹˜ íƒìƒ‰ ë²”ìœ„

#### 1.3 Fallback ì‹œìŠ¤í…œ

**ì‹ ê·œ ë„ì…**: 4ë‹¨ê³„ ì ì‘í˜• Fallback
- Level 1: Antardasha Buffer 6ê°œì›” â†’ 12ê°œì›”
- Level 2: Mahadashaë§Œ ë§¤ì¹­
- Level 3: Mahadasha Buffer Â±2ë…„
- Level 4: ì‚¬ê±´ ê²€ì¦ ìŠ¤í‚µ

**Confidence Penalty**:
- Level 1: -1 (B+ â†’ B)
- Level 2: -1 (B â†’ B-)
- Level 3: -2 (B- â†’ C+)

#### 1.4 GDPR ê°•í™”

**ì‹ ê·œ ê¸ˆì§€ í•„ë“œ**:
- `birth_place_coords` (ìœ„ë„/ê²½ë„ ìœ„ì¹˜ ì¶”ì  ë¦¬ìŠ¤í¬)
- `ip_address` (IPëŠ” ìˆ˜ì§‘ ê¸ˆì§€)

**UI ê°œì„ **:
- JavaScript í•„ìˆ˜ ì²´í¬ ê²€ì¦
- ëª…ì‹œì  ë™ì˜ ì²´í¬ë°•ìŠ¤
- CSRF ë³´í˜¸

#### 1.5 í…ŒìŠ¤íŠ¸ ì¸í”„ë¼

**ì¶”ê°€ ì‚¬í•­**:
- `test_cases.json` fallback íŠ¸ë¦¬ê±° ì¼€ì´ìŠ¤ ì˜ˆì‹œ
- ë²¤ì¹˜ë§ˆí¬ ë¹„êµ ìŠ¤í¬ë¦½íŠ¸
- Phase 2.5 êµ¬í˜„ ìš°ì„ ìˆœìœ„ ê°€ì´ë“œ

#### 1.6 Breaking Changes ì—ëŸ¬ ë©”ì‹œì§€

**ê°œì„  ì „**: ì¶”ìƒì ì¸ ì—ëŸ¬ ì„¤ëª…
**ê°œì„  í›„**: êµ¬ì²´ì ì¸ í•´ê²° ë°©ë²• í¬í•¨

ì˜ˆì‹œ:
```
RuntimeError: FactoryData migration incomplete
Missing required section: 'event_rules'

This is a breaking change. To fix:
1. Backup: cp FactoryData.json FactoryData.backup.json
2. Run: python scripts/migrate_factory_data.py --add-event-rules
3. Verify: python scripts/validate_factory_data.py

Engine startup aborted.
```

---

## 2. ì‹œìŠ¤í…œ ì² í•™

### 2.1 ìƒì‹œë³´ì •ì˜ ë³¸ì§ˆ

ìƒì‹œë³´ì •ì€ **í™•ë¥  ì¶”ë¡  ì—”ì§„**ì´ë‹¤.

- ìƒìŠ¹ê¶ì„ ì§ì ‘ ë§ì¶”ëŠ” ê²ƒì´ ì•„ë‹ˆë¼
- **ì‚¬ìš©ì ì‚¶ì˜ íŒ¨í„´ â†’ ì ì„±í•™ êµ¬ì¡°ë¡œ ì—­ì¶”ë¡ **í•œë‹¤.

### 2.2 ì™œ ìƒìŠ¹ê¶ ì¤‘ì‹¬ì¸ê°€

ìƒìŠ¹ê¶ì€:
- ì°¨íŠ¸ì˜ ê¸°ì¤€ì 
- í•˜ìš°ìŠ¤ êµ¬ì¡° ê²°ì •
- ì™¸ëª¨/ì„±í–¥/ì‚¬ê±´ íë¦„ ë°˜ì˜

ë”°ë¼ì„œ: **ìƒìŠ¹ê¶ ì •í™•ë„ = ì „ì²´ ë¦¬ë”© ì •í™•ë„**

### 2.3 FactoryDataì˜ ì—­í• 

FactoryDataëŠ” **ì ì„±í•™ ì§€ì‹ ê·¸ë˜í”„**ì´ë‹¤.

**ê¸°ëŠ¥**:
- í”¼ì²˜ ì‚¬ì „
- ì„¤ëª… ìƒì„±
- ì ìˆ˜ ê³„ì‚°
- ML í•™ìŠµ ê¸°ë°˜

### 2.4 í•µì‹¬ ì„¤ê³„ ì›ì¹™

ìƒì‹œë³´ì • ì—”ì§„ì€:

1. **í™•ë¥  ëª¨ë¸** â€” ê²°ì •ë¡ ì´ ì•„ë‹Œ í™•ë¥  ë¶„í¬ ê¸°ë°˜
2. **ì„¤ëª… ê°€ëŠ¥í•œ ì ì„±í•™** â€” ëª¨ë“  ê²°ê³¼ì— ê·¼ê±° ì œì‹œ
3. **ì‚¬ìš©ì ì‹ ë¢°** â€” ì‹ ë¢°ë„ ë“±ê¸‰ + íˆ¬ëª…í•œ ì„¤ëª…

---

## 3. ì ì„±í•™ ëª¨ë¸ êµ¬ì¡°

### 3.1 ëª¨ë¸ ê³„ì¸µ

```
Ascendant Layer
â†’ House Layer
â†’ Planet State Layer
â†’ Event Pattern Layer
```

ì´ˆê¸° ì—”ì§„ì€ **Ascendant ì¤‘ì‹¬**ìœ¼ë¡œ ë™ì‘í•œë‹¤.

### 3.2 ì‚¬ê±´ ê²€ì¦ ë…¼ë¦¬

ì‚¬ê±´ì€:
- í•˜ìš°ìŠ¤ í™œì„±í™”
- ë‹¤ìƒ¤ íƒ€ì´ë°
- í–‰ì„± ì˜í–¥

ì„ í†µí•´ ê²€ì¦í•œë‹¤.

---

## 4. ì—”ì§„ ì•„í‚¤í…ì²˜

### 4.1 ì „ì²´ íŒŒì´í”„ë¼ì¸

```
User Input
â†’ Time Candidate Generator (2ë‹¨ê³„: Coarse â†’ Fine)
â†’ Adaptive Question Engine
â†’ Feature Mapper (2ë‹¨ê³„: Static Base â†’ Contextual)
â†’ Scoring Engine (ì²´ê°íš¨ìš© ì ìš©)
â†’ Event Validator (ë‹¤ìƒ¤ ë§¤ì¹­ + ë¡œê·¸í•©)
â†’ Degree Estimator (Circular Mean)
â†’ Cusp Detector + Tiebreaker
â†’ Confidence Grader
â†’ Explanation Engine
â†’ Result Renderer
â†’ Feedback Collector
â†’ Logging System
```

### 4.2 ì„±ëŠ¥ ëª©í‘œ

| ë‹¨ê³„ | ëª©í‘œ | ë¹„ê³  |
|------|------|------|
| í‘œë³¸ ìƒì„± (Coarse+Fine) | < 2ì´ˆ | ephemeris ê³„ì‚° í¬í•¨ |
| ìŠ¤ì½”ì–´ë§ (ì „ì²´ í‘œë³¸) | < 500ms | 100í‘œë³¸ ê¸°ì¤€ |
| ë‹¤ìƒ¤ ê³„ì‚° (ì „ì²´ í‘œë³¸ Ã— ì‚¬ê±´ 5ê°œ) | < 3ì´ˆ | Mahadashaë§Œ, AntardashaëŠ” Phase 2 |
| ë„ìˆ˜ ì¶”ì • + ê²°ê³¼ ìƒì„± | < 200ms | |
| **ì „ì²´ íŒŒì´í”„ë¼ì¸** | **< 6ì´ˆ** | ì§ˆë¬¸ ì‘ë‹µ ì‹œê°„ ì œì™¸ |

### 4.3 ìºì‹± ì •ì±…

- ë™ì¼ ìƒë…„ì›”ì¼ + ë™ì¼ ì‹œê°„ë²”ìœ„ì˜ **í‘œë³¸(planet_positions)ì€ ìºì‹±**
- ì§ˆë¬¸ ì‘ë‹µì´ ë°”ë€Œë©´ ìŠ¤ì½”ì–´ë§ë§Œ ì¬ê³„ì‚° (í‘œë³¸ ì¬ìƒì„± ë¶ˆí•„ìš”)

---

## 5. ì‹œê°„ í‘œë³¸ ìƒì„±

### 5.1 2ë‹¨ê³„ í‘œë³¸ ìƒì„± (Coarse â†’ Fine)

#### Phase A: Coarse Scan

```python
interval = 5ë¶„
candidates = generate(start_time, end_time, interval)
# â†’ ~36ê°œ í‘œë³¸ (3ì‹œê°„ ë²”ìœ„ ê¸°ì¤€)
```

ê° í‘œë³¸ì— ëŒ€í•´ `asc_sign` ê³„ì‚° â†’ **sign ì „í™˜ì (cusp boundary)** íƒì§€

#### Phase B: Fine Scan (cusp ê·¼ì²˜)

```python
cusp_detected_at = [tâ‚, tâ‚‚, ...]   # signì´ ë°”ë€ŒëŠ” ì‹œì 

for each cusp_time in cusp_detected_at:
    fine_candidates = generate(
        cusp_time - 15min, 
        cusp_time + 15min, 
        interval=1ë¶„
    )
    candidates += fine_candidates
```

#### ìµœì¢… í‘œë³¸ ìˆ˜

- ê¸°ë³¸: ~36ê°œ
- cuspë‹¹ ì¶”ê°€: ~30ê°œ
- ì¼ë°˜ì  3ì‹œê°„ ë²”ìœ„(cusp 1~2ê°œ): **ì´ 60~100ê°œ í‘œë³¸**

### 5.2 í‘œë³¸ ë°ì´í„° êµ¬ì¡°

```json
{
  "candidate_id": "C_0042",
  "time": "1994-12-18T14:35:00+09:00",
  "asc_sign": "Virgo",
  "asc_degree_in_sign": 14.23,
  "asc_abs_longitude": 164.23,
  "planet_positions": {
    "Sun": { 
      "sign": "Sagittarius", 
      "degree": 25.8, 
      "house": 4 
    },
    "Moon": { 
      "sign": "Cancer", 
      "degree": 12.1, 
      "house": 11 
    },
    "Mars": {
      "sign": "Leo", 
      "degree": 8.5, 
      "house": 12,
      "dignity": "neutral", 
      "aspected_by": ["Saturn"]
    }
  },
  "nakshatra_moon": {
    "name": "Pushya",
    "degree_in_nakshatra": 8.2
  },
  "score_personality": 0.0,
  "score_event": 0.0,
  "score_total": 0.0,
  "is_cusp_zone": false
}
```

---

## 6. ì§ˆë¬¸ ì‹œìŠ¤í…œ

### 6.1 ì§ˆë¬¸ êµ¬ì¡°

- **ì„±í–¥ ì§ˆë¬¸ 8ê°œ** (Q1â€“Q8): ìƒìŠ¹ê¶ íŒë³„
- **ì‚¬ê±´ ì§ˆë¬¸ 5ê°œ** (Q9â€“Q13): ì‹œê°„ ê²€ì¦
- **Cusp Tiebreaker** (ì„ íƒì ): cusp ê°ì§€ ì‹œ 1~2ê°œ ì¶”ê°€

### 6.2 ì§ˆë¬¸ ê°€ì¤‘ì¹˜ (Reliability Weight)

```
Q1â€“Q8:  R = 1.0
Q9â€“Q13: R = 1.3
```

### 6.3 ì ì‘í˜• ì§ˆë¬¸ ë¶„ê¸° (Adaptive Question Routing)

#### ëª©ì 

ëª¨ë“  ì‚¬ìš©ìì—ê²Œ ë™ì¼í•œ ì§ˆë¬¸ì„ ë˜ì§€ëŠ” ëŒ€ì‹ , **ì •ë³´ ì´ë“(Information Gain)** ê¸°ë°˜ìœ¼ë¡œ ë³€ë³„ë ¥ ë†’ì€ ì§ˆë¬¸ì„ ìš°ì„  ì„ íƒí•œë‹¤.

#### ì •ë³´ ì´ë“ ê³„ì‚°

í˜„ì¬ í›„ë³´ í™•ë¥  ë¶„í¬ë¥¼ Pë¼ í•˜ë©´:

```
H(P) = -Î£ P[asc] Ã— logâ‚‚(P[asc])    // í˜„ì¬ ì—”íŠ¸ë¡œí”¼

// ì§ˆë¬¸ Qkì˜ ê° ì˜µì…˜ jì— ëŒ€í•´:
P_after(Qk, j) = í•´ë‹¹ ì˜µì…˜ì˜ feature ë°˜ì˜ í›„ ê°±ì‹ ëœ ë¶„í¬
H_after(Qk) = Î£_j  P(option_j) Ã— H(P_after(Qk, j))

IG(Qk) = H(P) - H_after(Qk)
```

#### ì„ íƒ ê·œì¹™

- **Q1â€“Q3**: ê³ ì • ì¶œì œ (ì´ˆê¸° ë¶„í¬ í˜•ì„± í•„ìˆ˜)
- **Q4â€“Q8**: IG ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ í›„ **ìƒìœ„ 3ê°œë§Œ ì¶œì œ**
- **ì¡°ê¸° ì¢…ë£Œ ì¡°ê±´**: Top-1 í™•ë¥  â‰¥ 0.65ì´ë©´ ì„±í–¥ ì§ˆë¬¸ ì¤‘ë‹¨ â†’ ì‚¬ê±´ ì§ˆë¬¸ìœ¼ë¡œ ì´ë™

#### P(option_j) ì¶”ì •

ì‚¬ì „ í†µê³„ê°€ ì—†ëŠ” ì´ˆê¸°ì—ëŠ” ê· ë“± ë¶„í¬(1/4) ê°€ì •. ë¡œê·¸ ëˆ„ì  í›„ ì‹¤ì œ ì‘ë‹µ ë¹ˆë„ë¡œ êµì²´ ê°€ëŠ¥.

#### UX ì˜í–¥

- ìµœì†Œ ì§ˆë¬¸ ìˆ˜: 3(ì„±í–¥) + 5(ì‚¬ê±´) = **8ë¬¸í•­**
- ìµœëŒ€ ì§ˆë¬¸ ìˆ˜: 8(ì„±í–¥) + 5(ì‚¬ê±´) = **13ë¬¸í•­**
- í‰ê·  ê¸°ëŒ€: **6(ì„±í–¥) + 5(ì‚¬ê±´) = 11ë¬¸í•­**

### 6.4 ì„±í–¥ ì§ˆë¬¸ í…ìŠ¤íŠ¸ (Q1â€“Q8)

#### Q1 ì²«ì¸ìƒ
- A. ê°•í•œ ì¹´ë¦¬ìŠ¤ë§ˆ
- B. ì°¨ê°‘ê³  ê±°ë¦¬ê°
- C. ì¹œê·¼í•¨
- D. ë˜‘ë˜‘í•¨

#### Q2 ìŠ¤íŠ¸ë ˆìŠ¤ ë°˜ì‘
- A. í–‰ë™
- B. ê³ ë¦½
- C. ëŒ€í™”
- D. íšŒí”¼

#### Q3 ì—ë„ˆì§€ íƒ€ì…
- A. í­ë°œì 
- B. ì•ˆì •ì 
- C. ë³€ë™ í¼
- D. ê¹ŠìŒ

#### Q4 ì˜ì‚¬ê²°ì •
- A. ì§ê°
- B. ë¶„ì„
- C. íƒ€í˜‘
- D. ì‹ ì¤‘í•¨

#### Q5 ì‚¬íšŒì  ì—­í• 
- A. ë¦¬ë”
- B. ì „ë¬¸ê°€
- C. ì¤‘ì¬ì
- D. ê´€ì°°ì

#### Q6 ê°ì • í‘œí˜„
- A. ì§ì„¤ì 
- B. ì ˆì œ
- C. í’ë¶€
- D. ì€ìœ ì 

#### Q7 ë³€í™” ëŒ€ì‘
- A. ì¦‰ê° ì‹¤í–‰
- B. ì €í•­
- C. ìœ ì—°í•œ ì ì‘
- D. ì‹ ì¤‘í•œ ê´€ì°°

#### Q8 ê´€ê³„ íŒ¨í„´
- A. ì£¼ë„
- B. ë…ë¦½
- C. í˜‘ë ¥
- D. ì˜ì¡´

### 6.5 ì‚¬ê±´ ì§ˆë¬¸ í…ìŠ¤íŠ¸ (Q9â€“Q13)

#### Q9 ì²« ì¤‘ìš”í•œ ì§ì—…/í•™ì—… ê²½í—˜
- A. ì´ˆë“± ì¡¸ì—… ì „ (6-12ì„¸)
- B. ì¤‘ê³ ë“±í•™êµ ì‹œê¸° (13-18ì„¸)
- C. ëŒ€í•™/ì„±ì¸ ì´ˆê¸° (19-25ì„¸)
- D. 25ì„¸ ì´í›„
- **ì…ë ¥**: ì—°ë„ (í•„ìˆ˜), ì›” (ì„ íƒ)

#### Q10 ì²« ë…ë¦½ì  ì¬ì • í™œë™
- A. ìš©ëˆ/ì•„ë¥´ë°”ì´íŠ¸ (15ì„¸ ì´ì „)
- B. ì²« ì •ê·œì§/ì‚¬ì—… (15-25ì„¸)
- C. ì£¼ìš” ì¬ì • ì „í™˜ (25-35ì„¸)
- D. 35ì„¸ ì´í›„
- **ì…ë ¥**: ì—°ë„ (í•„ìˆ˜), ì›” (ì„ íƒ)

#### Q11 ì£¼ìš” ê´€ê³„ í˜•ì„± (ì—°ì• /ê²°í˜¼/íŒŒíŠ¸ë„ˆì‹­)
- A. ì²« ì—°ì•  (20ì„¸ ì´ì „)
- B. ì¤‘ìš”í•œ ê´€ê³„ ì‹œì‘ (20-30ì„¸)
- C. ê²°í˜¼/ë™ê±° (30ì„¸ ì´í›„)
- D. í•´ë‹¹ ì—†ìŒ
- **ì…ë ¥**: ì—°ë„ (í•„ìˆ˜), ì›” (ì„ íƒ)

#### Q12 ê°€ì¡±/ê±°ì£¼ì§€ ë³€í™”
- A. ìœ ë…„ê¸° ì´ì‚¬ (10ì„¸ ì´ì „)
- B. ë…ë¦½/ëŒ€í•™ (18-25ì„¸)
- C. ê²°í˜¼/ì¶œì‚° (25ì„¸ ì´í›„)
- D. í•´ë‹¹ ì—†ìŒ
- **ì…ë ¥**: ì—°ë„ (í•„ìˆ˜), ì›” (ì„ íƒ)

#### Q13 ìµœê·¼ ì¤‘ìš” ì‚¬ê±´ (3ë…„ ì´ë‚´)
- A. ì»¤ë¦¬ì–´ ì „í™˜
- B. ê±´ê°• ì´ìŠˆ
- C. ê´€ê³„ ë³€í™”
- D. ê±°ì£¼ì§€ ì´ë™
- **ì…ë ¥**: ì—°ë„ (í•„ìˆ˜), ì›” (í•„ìˆ˜ ê¶Œì¥)

> ğŸ’¡ **UX íŒ** (ì„ íƒì  ì ìš© - ë°ì´í„° ê²€ì¦ í•„ìš”):
> Q13 ì…ë ¥ ì‹œ "ì›”/ì¼ì„ ì…ë ¥í•˜ì‹œë©´ ì •í™•ë„ê°€ í–¥ìƒë  ìˆ˜ ìˆìŠµë‹ˆë‹¤." íŒ í‘œì‹œ

### 6.6 Cusp Tiebreaker ì§ˆë¬¸ (Q14-Q15)

Cusp ê²½ê³„ì—ì„œ ìƒìŠ¹ê¶ì´ ì• ë§¤í•  ë•Œ ì¶œì œ:

#### Q14 ì‹ ì²´ì  íŠ¹ì§•
- A. í‚¤ê°€ í° í¸
- B. ê·¼ìœ¡ì§ˆ/ìš´ë™ ì²´í˜•
- C. ë‚ ì”¬í•˜ê³  ë¯¼ì²©
- D. ì¤‘ê°„ ì²´ê²©

#### Q15 ìœ„ê¸° ìƒí™© ëŒ€ì²˜
- A. ì¦‰ê° ëŒ€ì‘
- B. ì‹ ì¤‘í•œ ê³„íš
- C. ìœ ì—°í•œ íƒ€í˜‘
- D. íšŒí”¼/ê´€ë§

---

## 7. Feature Mapping

### 7.1 2ë‹¨ê³„ ë§¤í•‘ ì „ëµ

#### 7.1.1 Static Base Mapping

ëª¨ë“  ì§ˆë¬¸ì˜ ì˜µì…˜ì„ 12ê°œ ìƒìŠ¹ê¶ì— ë§¤í•‘:

```python
FeatureMap = {
    "Q1_A": { "Aries": +8, "Leo": +7, "Scorpio": +5 },
    "Q1_B": { "Capricorn": +8, "Aquarius": +6, "Virgo": +4 },
    # ...
}
```

#### 7.1.2 Context-Aware Mapping (Phase 2)

í–‰ì„± ë°°ì¹˜ì— ë”°ë¼ ì ìˆ˜ ì¡°ì •:

```python
if Mars in Asc:
    FeatureMap["Q1_A"]["Virgo"] += 3  # ì›ë˜ ë‚®ì•˜ë˜ ì ìˆ˜ ìƒí–¥

if Moon in 1H:
    FeatureMap["Q2_C"]["Cancer"] += 4  # ëŒ€í™”í˜• ë°˜ì‘ ê°•í™”
```

### 7.2 Feature ì ìˆ˜ ë²”ìœ„

- **Base Score**: -10 ~ +10
- **Context Bonus**: 0 ~ +5

### 7.3 FactoryData êµ¬ì¡° (Feature Map)

```json
{
  "feature_map": {
    "Q1": {
      "question_text": "ì²«ì¸ìƒì´ ì–´ë–¤ê°€ìš”?",
      "reliability_weight": 1.0,
      "options": {
        "A": {
          "label": "ê°•í•œ ì¹´ë¦¬ìŠ¤ë§ˆ",
          "mapping": {
            "Aries": 8,
            "Leo": 7,
            "Scorpio": 5,
            "Sagittarius": 3
          }
        }
      }
    }
  }
}
```

---

## 8. ìŠ¤ì½”ì–´ë§ ì‹œìŠ¤í…œ

### 8.1 ë¡œê·¸ í•¨ìˆ˜ ëª…ì‹œ (ìì—°ë¡œê·¸)

**ì¤‘ìš”**: ëª¨ë“  ë¡œê·¸ ê³„ì‚°ì€ **ìì—°ë¡œê·¸ ln (base e)**ë¥¼ ì‚¬ìš©í•œë‹¤.

#### ìˆ˜ì‹ í‘œê¸°

```
ì ìˆ˜ = Î£ feature_score Ã— R(q) Ã— U(q)
ì‹ ë¢°ë„ = ln(1 + normalized_score)
```

**Python êµ¬í˜„**:
```python
import math

# ì˜¬ë°”ë¥¸ í‘œê¸°
confidence = math.log(1 + normalized_score)

# ì˜ëª»ëœ í‘œê¸° (ì‚¬ìš© ê¸ˆì§€)
confidence = math.log10(1 + normalized_score)  # âŒ
```

#### ln ì„ íƒ ì´ìœ  (ìƒì„¸)

**1. Gradient ì•ˆì •ì„±**

ìì—°ë¡œê·¸ì˜ ë¯¸ë¶„:
```
d/dx ln(x) = 1/x
```

ìƒìš©ë¡œê·¸ì˜ ë¯¸ë¶„:
```
d/dx logâ‚â‚€(x) = 1/(xÂ·ln(10)) â‰ˆ 1/(xÂ·2.303)
```

â†’ lnì€ ì—­ì „íŒŒ ê³„ì‚°ì´ ê¹”ë”í•˜ê³ , ì¶”ê°€ ìƒìˆ˜ê°€ ì—†ì–´ ìˆ˜ì¹˜ ì•ˆì •ì„±ì´ ë†’ë‹¤.

**2. Softmax ìµœì í™”**

Softmax í•¨ìˆ˜:
```python
P(asc) = exp(score[asc]) / Î£ exp(score[i])
```

lnê³¼ expëŠ” ì—­í•¨ìˆ˜ ê´€ê³„:
```
exp(ln(x)) = x
ln(exp(x)) = x
```

â†’ ìˆ˜ì¹˜ ì–¸ë”í”Œë¡œìš°/ì˜¤ë²„í”Œë¡œìš° ë°©ì§€ì— ìµœì 

**3. ML í”„ë ˆì„ì›Œí¬ í‘œì¤€**

- PyTorch: `torch.log()` = ìì—°ë¡œê·¸
- TensorFlow: `tf.math.log()` = ìì—°ë¡œê·¸
- NumPy: `np.log()` = ìì—°ë¡œê·¸

â†’ Phase 3 ML ì „í™˜ ì‹œ ì½”ë“œ í˜¸í™˜ì„± ë³´ì¥

### 8.2 ì²´ê°íš¨ìš© í•¨ìˆ˜ (Utility Function)

#### ëª©ì 

ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì •ë³´ì˜ ì‹ ë¢°ë„ë¥¼ ë°˜ì˜:
- **ì—°ë„ë§Œ** ì…ë ¥: ë‚®ì€ íš¨ìš©
- **ì—°ë„+ì›”** ì…ë ¥: ë†’ì€ íš¨ìš©
- **ì—°ë„+ì›”+ì¼** ì…ë ¥: ìµœê³  íš¨ìš©

#### ìˆ˜ì‹

```
U(q) = base_utility Ã— completeness_factor

completeness_factor:
- ì—°ë„ë§Œ: 0.7
- ì—°ë„+ì›”: 0.9
- ì—°ë„+ì›”+ì¼: 1.0
```

#### ì½”ë“œ ì˜ˆì‹œ

```python
def calculate_utility(question_input):
    if 'day' in question_input:
        return 1.0
    elif 'month' in question_input:
        return 0.9
    else:
        return 0.7
```

### 8.3 ìŠ¤ì½”ì–´ ì •ê·œí™”

#### ëª©ì 

- ê° í›„ë³´ì˜ ì ìˆ˜ë¥¼ 0~1 ë²”ìœ„ë¡œ ì •ê·œí™”
- í™•ë¥  ë¶„í¬ë¡œ ë³€í™˜

#### ìˆ˜ì‹

```
normalized_score[i] = (raw_score[i] - min_score) / (max_score - min_score)
```

#### Softmax ë³€í™˜ (Phase 3)

```python
import numpy as np

def softmax(scores):
    exp_scores = np.exp(scores - np.max(scores))  # ì•ˆì •ì„± ìœ„í•´ ìµœëŒ“ê°’ ë¹¼ê¸°
    return exp_scores / np.sum(exp_scores)
```

### 8.4 ìŠ¤ì½”ì–´ë§ íŒŒì´í”„ë¼ì¸

```
1. Feature Score ê³„ì‚° (Base + Context)
2. Reliability Weight ì ìš© (R(q))
3. Utility ì ìš© (U(q))
4. ì „ì²´ í•©ì‚°
5. ì •ê·œí™”
6. ln ë³€í™˜ (ì‹ ë¢°ë„ ê³„ì‚°ìš©)
```

---

## 9. ì‚¬ê±´ ê²€ì¦ ì‹œìŠ¤í…œ

### 9.1 Event Rules JSON ìŠ¤í‚¤ë§ˆ

#### êµ¬ì¡°

```json
{
  "event_rules": {
    "Q9_A": {
      "question_id": "Q9",
      "option_id": "A",
      "event_type": "education",
      "description": "ì´ˆë“± ì¡¸ì—… ì „ ì¤‘ìš”í•œ í•™ì—… ê²½í—˜",
      "houses": [1, 2, 4, 9],
      "planets": ["Mercury", "Jupiter"],
      "base_weight": 1.3,
      "weight_range": [0.5, 10.0],
      "ml_trainable": true,
      "fallback_levels": [1, 2, 3]
    }
  }
}
```

#### í•„ë“œ ì„¤ëª…

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `question_id` | string | ì§ˆë¬¸ ID (Q9-Q13) |
| `option_id` | string | ì˜µì…˜ ID (A-D) |
| `event_type` | string | ì‚¬ê±´ ì¹´í…Œê³ ë¦¬ (education, career, relationship ë“±) |
| `description` | string | ì‚¬ê±´ ì„¤ëª… |
| `houses` | array | í™œì„±í™”ë˜ì–´ì•¼ í•  í•˜ìš°ìŠ¤ ëª©ë¡ |
| `planets` | array | ê´€ë ¨ í–‰ì„± |
| `base_weight` | float | ê¸°ë³¸ ê°€ì¤‘ì¹˜ (1.3) |
| `weight_range` | array | [min, max] ML í•™ìŠµ ì‹œ íƒìƒ‰ ë²”ìœ„ |
| `ml_trainable` | boolean | Phase 3ì—ì„œ í•™ìŠµí• ì§€ ì—¬ë¶€ |
| `fallback_levels` | array | í—ˆìš© Fallback ë ˆë²¨ |

#### ì˜ˆì‹œ (ì „ì²´)

```json
{
  "event_rules": {
    "Q9_A": {
      "question_id": "Q9",
      "option_id": "A",
      "event_type": "education",
      "houses": [1, 2, 4, 9],
      "planets": ["Mercury", "Jupiter"],
      "base_weight": 1.3,
      "weight_range": [0.5, 10.0],
      "ml_trainable": true,
      "fallback_levels": [1, 2, 3]
    },
    "Q10_B": {
      "question_id": "Q10",
      "option_id": "B",
      "event_type": "career",
      "houses": [2, 6, 10],
      "planets": ["Sun", "Saturn"],
      "base_weight": 1.3,
      "weight_range": [1.0, 5.0],
      "ml_trainable": true,
      "fallback_levels": [1, 2, 3]
    },
    "Q11_B": {
      "question_id": "Q11",
      "option_id": "B",
      "event_type": "relationship",
      "houses": [5, 7, 11],
      "planets": ["Venus", "Mars"],
      "base_weight": 1.3,
      "weight_range": [1.0, 8.0],
      "ml_trainable": true,
      "fallback_levels": [1, 2]
    },
    "Q12_C": {
      "question_id": "Q12",
      "option_id": "C",
      "event_type": "family",
      "houses": [4, 5, 11],
      "planets": ["Moon", "Jupiter"],
      "base_weight": 1.3,
      "weight_range": [0.5, 6.0],
      "ml_trainable": true,
      "fallback_levels": [1, 2, 3]
    },
    "Q13_A": {
      "question_id": "Q13",
      "option_id": "A",
      "event_type": "career_change",
      "houses": [1, 6, 10],
      "planets": ["Sun", "Saturn", "Rahu"],
      "base_weight": 1.5,
      "weight_range": [2.5, 8.0],
      "ml_trainable": true,
      "fallback_levels": [1]
    }
  }
}
```

### 9.2 Vimshottari Dasha ê³„ì‚°

#### Mahadasha ì£¼ê¸° (ê¸°ë³¸ê°’)

| í–‰ì„± | ì£¼ê¸° (ë…„) |
|------|-----------|
| Ketu | 7 |
| Venus | 20 |
| Sun | 6 |
| Moon | 10 |
| Mars | 7 |
| Rahu | 18 |
| Jupiter | 16 |
| Saturn | 19 |
| Mercury | 17 |

**Total**: 120ë…„ (ìˆœí™˜)

#### Nakshatra â†’ Mahadasha ë§¤í•‘

Moon Nakshatraì— ë”°ë¼ ì¶œìƒ ì‹œ Mahadashaê°€ ê²°ì •ë¨.

ì˜ˆì‹œ:
- Ashwini, Magha, Mula â†’ Ketu
- Bharani, Purva Phalguni, Purva Ashadha â†’ Venus
- Krittika, Uttara Phalguni, Uttara Ashadha â†’ Sun
- ...

#### Antardasha ê³„ì‚° (Phase 2)

Mahadasha ë‚´ì—ì„œ ì„¸ë¶„í™”:

```
Antardasha ê¸°ê°„ = (Mahadasha ê¸°ê°„ Ã— Antardasha í–‰ì„± ì£¼ê¸°) / 120
```

ì˜ˆ: Venus Mahadasha (20ë…„) ë‚´ Sun Antardasha:
```
(20 Ã— 6) / 120 = 1ë…„
```

### 9.3 ì‚¬ê±´ ë§¤ì¹­ ë¡œì§

#### ê¸°ë³¸ ë§¤ì¹­ (Mahadasha)

```python
def match_event(event_year, candidate):
    dasha_info = calculate_dasha(candidate)
    mahadasha_planet = dasha_info['mahadasha']
    
    rule = EventRules[event_type]
    if mahadasha_planet in rule['planets']:
        return True
    return False
```

#### ì—„ê²© ë§¤ì¹­ (Antardasha, Phase 2)

```python
def strict_match_event(event_year, event_month, candidate):
    dasha_info = calculate_dasha(candidate, include_antardasha=True)
    
    mahadasha = dasha_info['mahadasha']
    antardasha = dasha_info['antardasha']
    
    rule = EventRules[event_type]
    
    if mahadasha in rule['planets'] and antardasha in rule['planets']:
        return True
    return False
```

### 9.4 Fallback ì‹œìŠ¤í…œ (4ë‹¨ê³„ ì ì‘í˜•)

#### ëª©ì 

ì‚¬ê±´ ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ ì ì§„ì ìœ¼ë¡œ ì¡°ê±´ì„ ì™„í™”í•˜ì—¬ **ì¼ë¶€ í›„ë³´ë¼ë„ ì‚´ë¦¼**.

#### Fallback ë ˆë²¨

| ë ˆë²¨ | ì¡°ê±´ | Confidence Penalty |
|------|------|-------------------|
| 0 (ê¸°ë³¸) | Antardasha Â±3ê°œì›” Buffer | 0 |
| 1 | Antardasha Â±6ê°œì›” â†’ Â±12ê°œì›” Buffer | -1 (B+ â†’ B) |
| 2 | Mahadashaë§Œ ë§¤ì¹­ (Antardasha ë¬´ì‹œ) | -1 (B â†’ B-) |
| 3 | Mahadasha Â±2ë…„ Buffer | -2 (B- â†’ C+) |
| 4 | ì‚¬ê±´ ê²€ì¦ ìŠ¤í‚µ | -3 (C+ â†’ C-) |

#### Fallback íŠ¸ë¦¬ê±° ì¡°ê±´

```python
def apply_fallback(candidates, event_rules):
    level = 0
    max_level = 4
    
    while level <= max_level:
        matched = filter_candidates(candidates, event_rules, level)
        
        if len(matched) >= MIN_CANDIDATES:  # ìµœì†Œ 5ê°œ
            return matched, level
        
        level += 1
    
    # Fallback 4ë„ ì‹¤íŒ¨ ì‹œ
    return candidates, 4  # ì‚¬ê±´ ê²€ì¦ ì™„ì „ ìŠ¤í‚µ
```

#### YAML ì„¤ì • ì˜ˆì‹œ

```yaml
fallback_config:
  level_1:
    antardasha_buffer_months: 12
    confidence_penalty: -1
  level_2:
    use_mahadasha_only: true
    confidence_penalty: -1
  level_3:
    mahadasha_buffer_years: 2
    confidence_penalty: -2
  level_4:
    skip_event_validation: true
    confidence_penalty: -3
```

#### ë¡œê·¸ ê¸°ë¡

```json
{
  "event_id": "Q10_2016",
  "fallback_used": true,
  "fallback_level": 1,
  "original_buffer": "Â±3 months",
  "adjusted_buffer": "Â±12 months",
  "candidates_before": 0,
  "candidates_after": 8,
  "confidence_penalty": -1
}
```

### 9.5 ë¡œê·¸ í•©ì‚° (Log-Sum Aggregation)

#### ëª©ì 

ì—¬ëŸ¬ ì‚¬ê±´ì˜ ê²€ì¦ ì ìˆ˜ë¥¼ í•©ì‚°í•  ë•Œ **ê·¹ë‹¨ê°’ì— ëœ ë¯¼ê°**í•˜ê²Œ.

#### ìˆ˜ì‹

```
log_sum_score = ln(Î£ exp(event_score[i]))
```

ì´ëŠ” **LogSumExp** í•¨ìˆ˜ì™€ ë™ì¼:
```
LSE(xâ‚, xâ‚‚, ..., xâ‚™) = ln(exp(xâ‚) + exp(xâ‚‚) + ... + exp(xâ‚™))
```

#### ì¥ì 

- ì¼ë¶€ ì‚¬ê±´ ì‹¤íŒ¨í•´ë„ ë‹¤ë¥¸ ì‚¬ê±´ì´ ë³´ìƒ
- ìˆ˜ì¹˜ ì•ˆì •ì„± (ì–¸ë”í”Œë¡œìš° ë°©ì§€)

#### ìˆ˜ì¹˜ ì•ˆì •ì„± êµ¬í˜„

```python
import numpy as np

def log_sum_exp(scores):
    max_score = np.max(scores)
    return max_score + np.log(np.sum(np.exp(scores - max_score)))
```

### 9.6 ì‚¬ê±´ ì ìˆ˜ ê³„ì‚°

#### ê°œë³„ ì‚¬ê±´ ì ìˆ˜

```
match â†’ +50
ë¯¸ìŠ¤ë§¤ì¹˜ â†’ -50
```

#### ì „ì²´ ì‚¬ê±´ ì ìˆ˜

```python
event_scores = []

for event in events:
    if match_event(event, candidate):
        event_scores.append(+50 * event_weight)
    else:
        event_scores.append(-50 * event_weight)

total_event_score = log_sum_exp(event_scores)
```

---

## 10. ë„ìˆ˜ ì¶”ì • ë° Cusp ì²˜ë¦¬

### 10.1 Circular Mean (ì›í˜• í‰ê· )

#### ëª©ì 

ê°ë„ì˜ í‰ê· ì„ êµ¬í•  ë•Œ **360Â° ê²½ê³„ ë¬¸ì œ** í•´ê²°.

ì˜ˆ: 359Â°ì™€ 1Â°ì˜ í‰ê·  â†’ 180Â° (X), 0Â° (O)

#### ìˆ˜ì‹

```
ê°ë„ë¥¼ ë‹¨ìœ„ ë²¡í„°ë¡œ ë³€í™˜:
x = cos(Î¸)
y = sin(Î¸)

í‰ê·  ë²¡í„°:
xÌ„ = Î£(w[i] Ã— x[i]) / Î£w[i]
È³ = Î£(w[i] Ã— y[i]) / Î£w[i]

í‰ê·  ê°ë„:
Î¸Ì„ = atan2(È³, xÌ„)
```

#### Python êµ¬í˜„

```python
import numpy as np

def circular_mean(angles_deg, weights):
    angles_rad = np.deg2rad(angles_deg)
    
    x = np.sum(weights * np.cos(angles_rad)) / np.sum(weights)
    y = np.sum(weights * np.sin(angles_rad)) / np.sum(weights)
    
    mean_rad = np.arctan2(y, x)
    mean_deg = np.rad2deg(mean_rad)
    
    if mean_deg < 0:
        mean_deg += 360
    
    return mean_deg
```

### 10.2 Cusp ê°ì§€ (Sign Boundary Detection)

#### ì •ì˜

Cusp: ìƒìŠ¹ê¶ì´ **ë³„ìë¦¬ ê²½ê³„(0Â°/30Â°)**ì— ê°€ê¹Œìš´ ìƒíƒœ

#### ê°ì§€ ì¡°ê±´

```python
def is_cusp(asc_degree_in_sign):
    return (asc_degree_in_sign < 3.0) or (asc_degree_in_sign > 27.0)
```

#### Cusp Zone í”Œë˜ê·¸

í‘œë³¸ ìƒì„± ì‹œ `is_cusp_zone` í•„ë“œ ì¶”ê°€:

```json
{
  "candidate_id": "C_0042",
  "asc_degree_in_sign": 1.2,
  "is_cusp_zone": true
}
```

### 10.3 Cusp Tiebreaker

#### ì¡°ê±´

Top-2 í›„ë³´ê°€ **ì¸ì ‘ ë³„ìë¦¬**ì´ê³  ì ìˆ˜ ì°¨ì´ê°€ **5% ì´ë‚´**ì¼ ë•Œ ì¶œì œ.

ì˜ˆ:
- í›„ë³´ 1: Virgo (score = 82)
- í›„ë³´ 2: Leo (score = 80)
- ì°¨ì´: 2.4% â†’ Tiebreaker ì¶œì œ

#### Tiebreaker ì§ˆë¬¸

Q14 (ì‹ ì²´ íŠ¹ì§•), Q15 (ìœ„ê¸° ëŒ€ì²˜) ì¤‘ 1~2ê°œ.

#### ë§¤í•‘ ì˜ˆì‹œ

```json
{
  "Q14_A": { "Leo": +10, "Virgo": -5 },
  "Q14_B": { "Aries": +10, "Taurus": -5 }
}
```

#### ì¬ìŠ¤ì½”ì–´ë§

Tiebreaker ì‘ë‹µ í›„ **Top-2 í›„ë³´ì—ë§Œ** ì ìˆ˜ ì¶”ê°€ â†’ ì¬ì •ë ¬.

---

## 11. ì‹ ë¢°ë„ ë“±ê¸‰ ì‹œìŠ¤í…œ

### 11.1 ì‹ ë¢°ë„ ë“±ê¸‰ ì •ì˜

| ë“±ê¸‰ | ì ìˆ˜ ë²”ìœ„ | ì„¤ëª… |
|------|-----------|------|
| **A+** | 95-100 | ë§¤ìš° ë†’ì€ í™•ì‹  (ì‚¬ê±´ ì™„ë²½ ë§¤ì¹­ + ì„±í–¥ ì¼ì¹˜) |
| **A** | 90-94 | ë†’ì€ í™•ì‹  |
| **A-** | 85-89 | ì¤€ìˆ˜í•œ í™•ì‹  |
| **B+** | 80-84 | ì–‘í˜¸ |
| **B** | 75-79 | ë³´í†µ |
| **B-** | 70-74 | ë‚®ì€ í™•ì‹  |
| **C+** | 65-69 | ë¶ˆí™•ì‹¤ (Fallback ì‚¬ìš©) |
| **C** | 60-64 | ë§¤ìš° ë¶ˆí™•ì‹¤ |
| **C-** | < 60 | ì‹ ë¢° ë¶ˆê°€ |

### 11.2 ë“±ê¸‰ íŒì • ë¡œì§

```python
def grade_confidence(score, fallback_level):
    base_grade = calculate_base_grade(score)
    
    # Fallback Penalty
    penalty = {
        0: 0,
        1: -1,  # B+ â†’ B
        2: -1,  # B â†’ B-
        3: -2,  # B- â†’ C+
        4: -3   # C+ â†’ C-
    }
    
    final_grade = base_grade + penalty[fallback_level]
    return final_grade
```

### 11.3 ì‚¬ìš©ì ë©”ì‹œì§€

```python
grade_messages = {
    "A+": "ë§¤ìš° ë†’ì€ í™•ì‹ ìœ¼ë¡œ ì¶”ì •ëœ ìƒì‹œì…ë‹ˆë‹¤.",
    "A": "ë†’ì€ í™•ì‹ ìœ¼ë¡œ ì¶”ì •ëœ ìƒì‹œì…ë‹ˆë‹¤.",
    "B": "ì ì ˆí•œ í™•ì‹ ìœ¼ë¡œ ì¶”ì •ëœ ìƒì‹œì…ë‹ˆë‹¤. ì¶”ê°€ ê²€ì¦ ê¶Œì¥.",
    "C+": "ë¶ˆí™•ì‹¤í•œ ì¶”ì •ì…ë‹ˆë‹¤. ì „ë¬¸ê°€ ìƒë‹´ ê¶Œì¥.",
    "C-": "ì‹ ë¢°í•˜ê¸° ì–´ë ¤ìš´ ì¶”ì •ì…ë‹ˆë‹¤. ë” ë§ì€ ì •ë³´ í•„ìš”."
}
```

---

## 12. UX í”Œë¡œìš°

### 12.1 ì „ì²´ í”Œë¡œìš°

```
1. GDPR ë™ì˜ í™”ë©´
   â†“ (ë™ì˜)
2. ê¸°ë³¸ ì •ë³´ ì…ë ¥ (ìƒë…„ì›”ì¼, ì¶œìƒì§€, ì‹œê°„ ë²”ìœ„)
   â†“
3. ì„±í–¥ ì§ˆë¬¸ (Q1-Q8, ì ì‘í˜• ë¶„ê¸°)
   â†“ (ì¡°ê¸° ì¢…ë£Œ ê°€ëŠ¥)
4. ì‚¬ê±´ ì§ˆë¬¸ (Q9-Q13)
   â†“
5. Cusp Tiebreaker (ì¡°ê±´ë¶€)
   â†“
6. ê²°ê³¼ í™”ë©´ (ì¶”ì • ìƒì‹œ + ì‹ ë¢°ë„ + ì„¤ëª…)
   â†“
7. í”¼ë“œë°± ìˆ˜ì§‘
   â†“
8. ì„¸ì…˜ ì¢…ë£Œ
```

### 12.2 GDPR ë™ì˜ í”Œë¡œìš°

#### HTML ì˜ˆì‹œ

```html
<div class="gdpr-container">
  <h2>ê°œì¸ì •ë³´ ì²˜ë¦¬ ë°©ì¹¨</h2>
  <div class="gdpr-content">
    <p>ë‹¹ì‚¬ëŠ” ìƒì‹œë³´ì • ì„œë¹„ìŠ¤ ì œê³µì„ ìœ„í•´ ë‹¤ìŒ ì •ë³´ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤:</p>
    <ul>
      <li>ìƒë…„ì›”ì¼ (í•„ìˆ˜)</li>
      <li>ì¶œìƒ ë„ì‹œ/êµ­ê°€ (í•„ìˆ˜)</li>
      <li>ì§ˆë¬¸ ì‘ë‹µ (í•„ìˆ˜)</li>
    </ul>
    <p><strong>ìˆ˜ì§‘í•˜ì§€ ì•ŠëŠ” ì •ë³´:</strong></p>
    <ul>
      <li>IP ì£¼ì†Œ</li>
      <li>ì •ë°€ ìœ„ì¹˜ ì •ë³´ (ìœ„ë„/ê²½ë„)</li>
      <li>ê¸°ê¸° ì‹ë³„ì</li>
    </ul>
    <p>ë°ì´í„°ëŠ” ì„œë¹„ìŠ¤ ê°œì„  ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©ë˜ë©°, 24ì‹œê°„ í›„ ìë™ ì‚­ì œë©ë‹ˆë‹¤.</p>
  </div>
  
  <div class="gdpr-checkbox">
    <input type="checkbox" id="consent-checkbox" name="consent" required>
    <label for="consent-checkbox">
      ìœ„ ê°œì¸ì •ë³´ ì²˜ë¦¬ ë°©ì¹¨ì„ ì½ê³  ì´í•´í–ˆìœ¼ë©°, ì´ì— ë™ì˜í•©ë‹ˆë‹¤.
    </label>
  </div>
  
  <div class="gdpr-actions">
    <button onclick="acceptGDPR()">ë™ì˜í•˜ê³  ê³„ì†</button>
    <button onclick="rejectGDPR()">ê±°ë¶€</button>
  </div>
</div>
```

#### JavaScript ê²€ì¦

```javascript
function acceptGDPR() {
    const checkbox = document.getElementById('consent-checkbox');
    
    if (!checkbox.checked) {
        alert('ê°œì¸ì •ë³´ ì²˜ë¦¬ ë°©ì¹¨ì— ë™ì˜í•˜ì…”ì•¼ ê³„ì†í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        return;
    }
    
    // ë°±ì—”ë“œì— ë™ì˜ ê¸°ë¡
    fetch('/api/gdpr/consent', {
        method: 'POST',
        headers: { 
            'Content-Type': 'application/json',
            'X-CSRF-Token': getCsrfToken()
        },
        body: JSON.stringify({
            consent: true,
            timestamp: new Date().toISOString(),
            user_agent: navigator.userAgent
        })
    }).then(response => {
        if (response.ok) {
            window.location.href = '/birth-time-rectification';
        } else {
            alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        }
    }).catch(error => {
        console.error('GDPR consent error:', error);
        alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}

function rejectGDPR() {
    alert('ë™ì˜í•˜ì§€ ì•Šìœ¼ë©´ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    window.location.href = '/';
}

function getCsrfToken() {
    return document.querySelector('meta[name="csrf-token"]')?.content || '';
}
```

#### CSS ì˜ˆì‹œ

```css
.gdpr-container {
    max-width: 600px;
    margin: 50px auto;
    padding: 30px;
    background: #ffffff;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.gdpr-content {
    max-height: 400px;
    overflow-y: auto;
    margin-bottom: 20px;
    padding: 15px;
    background: #f9f9f9;
    border-radius: 4px;
}

.gdpr-checkbox {
    margin: 20px 0;
}

.gdpr-checkbox input[type="checkbox"] {
    margin-right: 10px;
}

.gdpr-actions {
    display: flex;
    gap: 10px;
    justify-content: center;
}

.gdpr-actions button {
    padding: 12px 30px;
    font-size: 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.gdpr-actions button:first-child {
    background: #4CAF50;
    color: white;
}

.gdpr-actions button:last-child {
    background: #f44336;
    color: white;
}
```

### 12.3 ì§ˆë¬¸ UI ì˜ˆì‹œ

```html
<div class="question-container">
  <h3>Q1. ì²«ì¸ìƒì´ ì–´ë–¤ê°€ìš”?</h3>
  <div class="options">
    <label>
      <input type="radio" name="q1" value="A">
      A. ê°•í•œ ì¹´ë¦¬ìŠ¤ë§ˆ
    </label>
    <label>
      <input type="radio" name="q1" value="B">
      B. ì°¨ê°‘ê³  ê±°ë¦¬ê°
    </label>
    <label>
      <input type="radio" name="q1" value="C">
      C. ì¹œê·¼í•¨
    </label>
    <label>
      <input type="radio" name="q1" value="D">
      D. ë˜‘ë˜‘í•¨
    </label>
  </div>
</div>
```

### 12.4 ê²°ê³¼ í™”ë©´ ì˜ˆì‹œ

```html
<div class="result-container">
  <h2>ì¶”ì • ìƒì‹œ: 14:32 (Â±5ë¶„)</h2>
  <div class="confidence">
    <span class="grade">ì‹ ë¢°ë„: A-</span>
    <p>ë†’ì€ í™•ì‹ ìœ¼ë¡œ ì¶”ì •ëœ ìƒì‹œì…ë‹ˆë‹¤.</p>
  </div>
  
  <div class="chart-info">
    <h3>ìƒìŠ¹ê¶: Virgo (ì²˜ë…€ìë¦¬)</h3>
    <p>ìƒìŠ¹ ë„ìˆ˜: 14.5Â°</p>
  </div>
  
  <div class="explanation">
    <h3>ì¶”ì • ê·¼ê±°</h3>
    <ul>
      <li>Q1 ì‘ë‹µ(A)ê³¼ Virgo ì„±í–¥ ì¼ì¹˜ (+8ì )</li>
      <li>2016ë…„ ì»¤ë¦¬ì–´ ì‚¬ê±´ â†’ Mahadasha: Saturn (ì¼ì¹˜)</li>
      <li>2023ë…„ ìµœê·¼ ì‚¬ê±´ â†’ Antardasha: Mercury (ì¼ì¹˜)</li>
    </ul>
  </div>
  
  <div class="feedback">
    <h3>í”¼ë“œë°±</h3>
    <p>ì¶”ì • ê²°ê³¼ê°€ ì •í™•í–ˆë‚˜ìš”?</p>
    <button onclick="submitFeedback('accurate')">ì •í™•í•¨</button>
    <button onclick="submitFeedback('inaccurate')">ë¶€ì •í™•í•¨</button>
  </div>
</div>
```

---

## 13. ë¡œê¹… ì‹œìŠ¤í…œ

### 13.1 ì„¸ì…˜ ë¡œê·¸ êµ¬ì¡°

```json
{
  "session_id": "S_20260209_142356",
  "timestamp_start": "2026-02-09T14:23:56+09:00",
  "timestamp_end": "2026-02-09T14:28:42+09:00",
  "input": {
    "birth_date": "1994-12-18",
    "birth_city": "Seoul",
    "birth_country": "KR",
    "time_range_start": "13:00",
    "time_range_end": "16:00"
  },
  "questions": {
    "Q1": "A",
    "Q2": "B",
    "Q9": {"option": "A", "year": 2014},
    "Q13": {"option": "A", "year": 2023, "month": 6}
  },
  "candidates_generated": 87,
  "candidates_after_filter": 12,
  "fallback_events": [
    {
      "question_id": "Q10",
      "fallback_level": 1,
      "buffer_extended": "Â±12 months"
    }
  ],
  "result": {
    "estimated_time": "14:32:00+09:00",
    "asc_sign": "Virgo",
    "asc_degree": 14.5,
    "confidence_grade": "A-",
    "confidence_score": 87.3
  },
  "performance": {
    "candidate_generation_ms": 1845,
    "scoring_ms": 423,
    "dasha_calculation_ms": 2156,
    "total_ms": 4982
  },
  "feedback": {
    "accuracy_rating": "accurate",
    "user_comment": null
  }
}
```

### 13.2 ë¡œê·¸ ë³´ê´€ ì •ì±…

- **ì¦‰ì‹œ ì‚­ì œ í•­ëª©**: IP ì£¼ì†Œ, ì •ë°€ ìœ„ì¹˜ ì •ë³´
- **24ì‹œê°„ ë³´ê´€**: ì„¸ì…˜ ë¡œê·¸ (ê°œì¸ì •ë³´ ì œê±° í›„)
- **ì˜êµ¬ ë³´ê´€**: ìµëª…í™”ëœ í†µê³„ ë°ì´í„°

### 13.3 ë¡œê·¸ ë¶„ì„ ëª©ì 

- ì •í™•ë„ í†µê³„
- Fallback ì‚¬ìš© ë¹ˆë„
- Phase 3 ML í•™ìŠµ ë°ì´í„°
- ì§ˆë¬¸ ê°œì„  (IG ë¶„ì„)

---

## 14. FactoryData êµ¬ì¡°

### 14.1 ì „ì²´ ìŠ¤í‚¤ë§ˆ

```json
{
  "version": "2.0",
  "last_updated": "2026-02-09",
  "feature_map": { ... },
  "event_rules": { ... },
  "dasha_config": { ... },
  "nakshatra_mappings": { ... },
  "karaka_info": { ... },
  "glossary": { ... }
}
```

### 14.2 Feature Map

Section 7 ì°¸ì¡°.

### 14.3 Event Rules

Section 9.1 ì°¸ì¡°.

### 14.4 Nakshatra Mappings

```json
{
  "nakshatra_mappings": {
    "Ashwini": { "ruling_planet": "Ketu", "degree_start": 0.0, "degree_end": 13.33 },
    "Bharani": { "ruling_planet": "Venus", "degree_start": 13.33, "degree_end": 26.67 },
    "Krittika": { "ruling_planet": "Sun", "degree_start": 26.67, "degree_end": 40.0 }
  }
}
```

### 14.5 Karaka Info

```json
{
  "karaka_info": {
    "Sun": {
      "natural_significations": ["Father", "Authority", "Career", "Soul"],
      "house_rulership": ["Leo"],
      "friendly_planets": ["Moon", "Mars", "Jupiter"],
      "enemy_planets": ["Saturn", "Venus"]
    },
    "Moon": {
      "natural_significations": ["Mother", "Emotions", "Mind", "Public"],
      "house_rulership": ["Cancer"],
      "friendly_planets": ["Sun", "Mercury"],
      "enemy_planets": []
    }
  }
}
```

---

## 15. ìš©ì–´ ì‚¬ì „

### 15.1 Karaka (í–‰ì„±ë³„ ìƒì§•)

| í–‰ì„± | ìì—°ì  ìƒì§• (Natural Karaka) |
|------|------------------------------|
| **Sun** | Father, Authority, Career, Soul, Government |
| **Moon** | Mother, Emotions, Mind, Public, Mental Health |
| **Mars** | Siblings, Courage, Energy, Property, Accidents |
| **Mercury** | Education, Communication, Intelligence, Business |
| **Jupiter** | Guru, Wisdom, Children, Fortune, Expansion |
| **Venus** | Spouse, Love, Luxury, Arts, Vehicles |
| **Saturn** | Longevity, Hardship, Discipline, Servants, Death |
| **Rahu** | Obsession, Foreign, Technology, Innovation |
| **Ketu** | Moksha, Spirituality, Liberation, Past Life |

### 15.2 Dasha

**Dasha**: í–‰ì„± ì£¼ê¸° ì‹œìŠ¤í…œ. ì¸ìƒì˜ íŠ¹ì • ì‹œê¸°ë¥¼ íŠ¹ì • í–‰ì„±ì´ "í†µì¹˜"í•œë‹¤.

- **Mahadasha**: ì£¼ìš” ì£¼ê¸° (7-20ë…„)
- **Antardasha**: ë¶€ì°¨ ì£¼ê¸° (Mahadasha ë‚´ ì„¸ë¶„í™”)
- **Vimshottari**: ê°€ì¥ ë„ë¦¬ ì“°ì´ëŠ” 120ë…„ ì£¼ê¸° ì²´ê³„

### 15.3 Nakshatra

**Nakshatra**: ë‹¬ì˜ ë³„ìë¦¬ (27ê°œ). ê° 13Â°20' í¬ê¸°.

ë‹¬ì´ ì¶œìƒ ì‹œ ìœ„ì¹˜í•œ Nakshatraì— ë”°ë¼ Mahadasha ì‹œì‘ì ì´ ê²°ì •ë¨.

### 15.4 Ascendant (ìƒìŠ¹ê¶)

**Lagna**: ì¶œìƒ ì‹œê°„ì— ë™ìª½ ì§€í‰ì„ ì— ë– ì˜¤ë¥´ëŠ” ë³„ìë¦¬.

ì°¨íŠ¸ì˜ **1í•˜ìš°ìŠ¤ ì‹œì‘ì **ì´ë©°, ì „ì²´ í•˜ìš°ìŠ¤ êµ¬ì¡°ë¥¼ ê²°ì •í•œë‹¤.

### 15.5 Cusp

**Cusp**: ë³„ìë¦¬ ê²½ê³„. ìƒìŠ¹ê¶ì´ cusp ê·¼ì²˜ì— ìˆìœ¼ë©´ ë¶ˆí™•ì‹¤ì„± ì¦ê°€.

### 15.6 Dignity (í–‰ì„± í’ˆìœ„)

| ìƒíƒœ | ì„¤ëª… |
|------|------|
| **Exalted** | ìµœê³  ê°•ë„ (ì˜ˆ: Sun in Aries) |
| **Own Sign** | ìê¸° ë³„ìë¦¬ (ì˜ˆ: Sun in Leo) |
| **Friendly** | ìš°í˜¸ì  ë³„ìë¦¬ |
| **Neutral** | ì¤‘ë¦½ |
| **Enemy** | ì ëŒ€ì  ë³„ìë¦¬ |
| **Debilitated** | ìµœì € ê°•ë„ (ì˜ˆ: Sun in Libra) |

---

## 16. Phase ë¡œë“œë§µ

### Phase 1 (í˜„ì¬)

**ëª©í‘œ**: MVP ì—”ì§„ ì™„ì„±

- [x] 2ë‹¨ê³„ í‘œë³¸ ìƒì„±
- [x] ì ì‘í˜• ì§ˆë¬¸
- [x] Feature Mapping (Static)
- [x] ìŠ¤ì½”ì–´ë§ (ln ëª…ì‹œ)
- [x] ì‚¬ê±´ ê²€ì¦ (Mahadasha)
- [x] Circular Mean ë„ìˆ˜ ì¶”ì •
- [x] Cusp ê°ì§€ + Tiebreaker
- [x] ì‹ ë¢°ë„ ë“±ê¸‰
- [x] GDPR UI
- [x] ë¡œê¹… ì‹œìŠ¤í…œ
- [x] Event Rules JSON

### Phase 2

**ëª©í‘œ**: ì •í™•ë„ í–¥ìƒ

- [ ] Antardasha ê³„ì‚° (ì‚¬ê±´ ê²€ì¦ ì—„ê²©í™”)
- [ ] Context-Aware Mapping (í–‰ì„± ë°°ì¹˜ ê¸°ë°˜)
- [ ] Fallback ì‹œìŠ¤í…œ ì‹¤ì „ ê²€ì¦
- [ ] weight_range ì„¸ë°€ ì¡°ì •
- [ ] ë²¤ì¹˜ë§ˆí¬ ë¹„êµ (vs Phase 1)
- [ ] A/B í…ŒìŠ¤íŠ¸ (í˜ë„í‹° ê°€ë³€í™”)

**ì˜ˆìƒ ê¸°ê°„**: 2-3ê°œì›”

### Phase 3

**ëª©í‘œ**: ML ì „í™˜

- [ ] ê°€ì¤‘ì¹˜ í•™ìŠµ (ml_trainable í•„ë“œ ê¸°ë°˜)
- [ ] ì‹ ê²½ë§ ëª¨ë¸ ë„ì…
- [ ] Fallback ë¡œê·¸ í™œìš© (ì‚¬ê±´ íƒ€ì…ë³„ ì˜¤ë¥˜ íŒ¨í„´)
- [ ] ìë™ ì§ˆë¬¸ ìµœì í™” (IG ê¸°ë°˜)
- [ ] ëŒ€ê·œëª¨ ë°ì´í„°ì…‹ êµ¬ì¶• (10,000+ ì„¸ì…˜)

**ì˜ˆìƒ ê¸°ê°„**: 6-12ê°œì›”

### Phase 2.5 (ì¤‘ê°„ ê°œì„ )

**ìš°ì„ ìˆœìœ„**:

1. ë²¤ì¹˜ë§ˆí¬ ë¹„êµ ìŠ¤í¬ë¦½íŠ¸ (ì¦‰ì‹œ)
2. weight_range ì„¸ë°€ ì¡°ì • (ë°ì´í„° ìˆ˜ì§‘ í›„)
3. Fallback ë¡œê·¸ ë¶„ì„ (ì§ˆë¬¸ ê°œì„ )
4. Q13 ê¸°ë³¸ ê°€ì¤‘ì¹˜ ìƒí–¥ ê²€í†  (ë°ì´í„° ê²€ì¦ í›„)
5. í˜ë„í‹° ê°€ë³€í™” A/B í…ŒìŠ¤íŠ¸
6. ì—£ì§€ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸ í™•ëŒ€

---

## 17. ì„±ëŠ¥ ìµœì í™”

### 17.1 í‘œë³¸ ìƒì„± ìµœì í™”

- **Coarse Scan ìºì‹±**: ë™ì¼ ìƒë…„ì›”ì¼+ì‹œê°„ë²”ìœ„ ì¬ì‚¬ìš©
- **Fine Scan ì¡°ê±´ë¶€**: cusp íƒì§€ ì‹œì—ë§Œ ì‹¤í–‰
- **ë³‘ë ¬ ê³„ì‚°**: ephemeris ê³„ì‚° ë©€í‹°ìŠ¤ë ˆë”©

### 17.2 ìŠ¤ì½”ì–´ë§ ìµœì í™”

- **ë²¡í„°í™”**: NumPy/Pandas ì‚¬ìš©
- **ì ì§„ì  ê°±ì‹ **: ì§ˆë¬¸ ì¶”ê°€ ì‹œ ì „ì²´ ì¬ê³„ì‚° ë¶ˆí•„ìš”
- **ìºì‹±**: ë™ì¼ ì‘ë‹µ íŒ¨í„´ ì¬ì‚¬ìš©

### 17.3 ë‹¤ìƒ¤ ê³„ì‚° ìµœì í™”

- **Mahadasha ìš°ì„ **: AntardashaëŠ” Phase 2
- **ì¡°ê¸° ì¢…ë£Œ**: ì‚¬ê±´ ë¯¸ìŠ¤ë§¤ì¹˜ ì‹œ ì¦‰ì‹œ íƒˆë½
- **ì‚¬ì „ ê³„ì‚°**: ì¶œìƒ Nakshatra â†’ Mahadasha í…Œì´ë¸” ìºì‹±

---

## 18. Phase 3 ì¤€ë¹„ì‚¬í•­

### 18.1 ml_trainable í•„ë“œ

Event Rules JSONì˜ `ml_trainable: true` í•„ë“œëŠ” **Phase 3ì—ì„œ í•™ìŠµí•  íŒŒë¼ë¯¸í„°**ë¥¼ í‘œì‹œí•œë‹¤.

í•™ìŠµ ëŒ€ìƒ:
- `base_weight`: ì‚¬ê±´ ê°€ì¤‘ì¹˜
- `feature_map` ì ìˆ˜: ì§ˆë¬¸ ì˜µì…˜ë³„ ìƒìŠ¹ê¶ ì ìˆ˜

### 18.2 weight_range ì„¤ì •

í˜„ì¬ ê¸°ë³¸ê°’:
```json
{
  "weight_range": [0.5, 10.0]
}
```

Phase 2.5ì—ì„œ ì‚¬ê±´ íƒ€ì…ë³„ë¡œ ì¡°ì •:

| ì‚¬ê±´ íƒ€ì… | ê¶Œì¥ ë²”ìœ„ | ì´ìœ  |
|-----------|-----------|------|
| Q13 (ìµœê·¼) | [2.5, 8.0] | ê¸°ì–µ ì •í™•ë„ ë†’ìŒ |
| Q9 (ì´ˆê¸°) | [0.3, 5.0] | ê¸°ì–µ ë¶ˆí™•ì‹¤ì„± í¼ |
| Q10-Q12 | [1.0, 6.0] | ì¤‘ê°„ |

### 18.3 ë°ì´í„° ìˆ˜ì§‘ ê³„íš

- ìµœì†Œ ëª©í‘œ: 1,000 ì„¸ì…˜
- ì´ìƒì  ëª©í‘œ: 10,000 ì„¸ì…˜
- í¬í•¨ ë°ì´í„°: ì§ˆë¬¸ ì‘ë‹µ, ì¶”ì • ìƒì‹œ, í”¼ë“œë°±, Fallback ë¡œê·¸

### 18.4 ë²¤ì¹˜ë§ˆí¬ ë¹„êµ ìŠ¤í¬ë¦½íŠ¸

```python
# scripts/benchmark_comparison.py

import json
from engine import BirthTimeEngine

def load_test_cases(filepath):
    with open(filepath, 'r') as f:
        return json.load(f)

def run_benchmark(engine, test_cases):
    results = []
    
    for case in test_cases:
        result = engine.estimate(
            birth_date=case['birth_date'],
            birth_city=case['birth_city'],
            time_range=case['time_range'],
            questions=case['questions']
        )
        
        results.append({
            'case_id': case['case_id'],
            'expected_asc': case['expected_asc'],
            'predicted_asc': result['asc_sign'],
            'confidence': result['confidence_grade'],
            'fallback_used': result.get('fallback_level', 0) > 0,
            'match': case['expected_asc'] == result['asc_sign']
        })
    
    return results

def calculate_metrics(results):
    total = len(results)
    correct = sum(1 for r in results if r['match'])
    fallback_count = sum(1 for r in results if r['fallback_used'])
    
    avg_confidence = sum(
        grade_to_score(r['confidence']) for r in results
    ) / total
    
    return {
        'accuracy': correct / total,
        'fallback_rate': fallback_count / total,
        'avg_confidence': avg_confidence
    }

if __name__ == '__main__':
    test_cases = load_test_cases('data/test_cases.json')
    
    engine = BirthTimeEngine(version='current')
    results = run_benchmark(engine, test_cases)
    metrics = calculate_metrics(results)
    
    print(f"Accuracy: {metrics['accuracy']:.2%}")
    print(f"Fallback Rate: {metrics['fallback_rate']:.2%}")
    print(f"Avg Confidence: {metrics['avg_confidence']:.1f}")
```

### 18.5 Fallback ë¡œê·¸ í™œìš©

ë¡œê·¸ì—ì„œ `fallback_used` í•„ë“œ ì¶”ì¶œ:

```python
# scripts/analyze_fallback.py

import json

def analyze_fallback_logs(log_dir):
    fallback_stats = {}
    
    for log_file in os.listdir(log_dir):
        with open(os.path.join(log_dir, log_file), 'r') as f:
            session = json.load(f)
        
        for event in session.get('fallback_events', []):
            qid = event['question_id']
            level = event['fallback_level']
            
            if qid not in fallback_stats:
                fallback_stats[qid] = {1: 0, 2: 0, 3: 0}
            
            fallback_stats[qid][level] += 1
    
    return fallback_stats

# ë¶„ì„ ê²°ê³¼ ì˜ˆì‹œ:
# {
#   "Q10": {1: 42, 2: 15, 3: 3},  # Q10ì—ì„œ Level 1 Fallback 42íšŒ ë°œìƒ
#   "Q11": {1: 8, 2: 2, 3: 0}
# }
```

ì´ë¥¼ í†µí•´:
- Q10ì—ì„œ Fallback ë¹ˆë²ˆ â†’ ì§ˆë¬¸ í…ìŠ¤íŠ¸ ê°œì„  í•„ìš”
- "ì·¨ì—… ì‹œê¸°ê°€ ë¶ˆí™•ì‹¤í•˜ë©´ ì „í›„ 1ë…„ ë²”ìœ„ë¡œ ê¸°ì–µí•´ì£¼ì„¸ìš”" íŒíŠ¸ ì¶”ê°€

---

## 19. Breaking Changes ë° ë§ˆì´ê·¸ë ˆì´ì…˜

### 19.1 Breaking Changes ëª©ë¡

| ë³€ê²½ ì‚¬í•­ | ì˜í–¥ | í•„ìˆ˜ ì¡°ì¹˜ |
|-----------|------|-----------|
| **Event Rules JSONí™”** | ì½”ë“œ â†’ ë°ì´í„° ë¶„ë¦¬ | FactoryData ë§ˆì´ê·¸ë ˆì´ì…˜ |
| **ë¡œê·¸ í•¨ìˆ˜ ëª…ì‹œ** | `log()` â†’ `ln()` | ì½”ë“œ ê²€í†  |
| **Fallback ì‹œìŠ¤í…œ** | ì‹ ê·œ ë¡œì§ ì¶”ê°€ | YAML ì„¤ì • ì¶”ê°€ |
| **GDPR ê°•í™”** | ê¸ˆì§€ í•„ë“œ í™•ëŒ€ | ìë™ ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸ |

### 19.2 ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

#### Step 1: FactoryData ë°±ì—…

```bash
cp FactoryData.json FactoryData.backup.json
```

#### Step 2: ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

```bash
python scripts/migrate_factory_data.py --add-event-rules
```

ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš©:

```python
# scripts/migrate_factory_data.py

import json

def migrate_to_current_version(data):
    # event_rules ì„¹ì…˜ ì¶”ê°€
    if 'event_rules' not in data:
        data['event_rules'] = generate_default_event_rules()
    
    # ml_trainable í•„ë“œ ì¶”ê°€
    for rule_id, rule in data['event_rules'].items():
        if 'ml_trainable' not in rule:
            rule['ml_trainable'] = True
        if 'weight_range' not in rule:
            rule['weight_range'] = [0.5, 10.0]
    
    # ë²„ì „ ì—…ë°ì´íŠ¸
    data['version'] = '2.0'
    
    return data

def generate_default_event_rules():
    return {
        "Q9_A": {
            "question_id": "Q9",
            "option_id": "A",
            "event_type": "education",
            "houses": [1, 2, 4, 9],
            "planets": ["Mercury", "Jupiter"],
            "base_weight": 1.3,
            "weight_range": [0.5, 10.0],
            "ml_trainable": True
        },
        # ... ë‚˜ë¨¸ì§€ ê·œì¹™
    }

if __name__ == '__main__':
    with open('FactoryData.json', 'r') as f:
        data = json.load(f)
    
    migrated = migrate_to_current_version(data)
    
    with open('FactoryData.json', 'w') as f:
        json.dump(migrated, f, indent=2)
    
    print("Migration completed successfully.")
```

#### Step 3: ê²€ì¦

```bash
python scripts/validate_factory_data.py
```

ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸:

```python
# scripts/validate_factory_data.py

import json

def validate_factory_data(filepath):
    with open(filepath, 'r') as f:
        data = json.load(f)
    
    errors = []
    
    # í•„ìˆ˜ ì„¹ì…˜ í™•ì¸
    required_sections = ['feature_map', 'event_rules', 'nakshatra_mappings']
    for section in required_sections:
        if section not in data:
            errors.append(f"Missing section: {section}")
    
    # event_rules ê²€ì¦
    if 'event_rules' in data:
        for rule_id, rule in data['event_rules'].items():
            if 'ml_trainable' not in rule:
                errors.append(f"{rule_id}: missing ml_trainable")
            if 'weight_range' not in rule:
                errors.append(f"{rule_id}: missing weight_range")
    
    if errors:
        print("Validation FAILED:")
        for error in errors:
            print(f"  - {error}")
        return False
    else:
        print("Validation PASSED.")
        return True

if __name__ == '__main__':
    validate_factory_data('FactoryData.json')
```

### 19.3 ì—ëŸ¬ ë©”ì‹œì§€ ì˜ˆì‹œ

#### event_rules ì—†ìŒ

```
RuntimeError: FactoryData migration incomplete
Missing required section: 'event_rules'

This is a breaking change. To fix:
1. Backup: cp FactoryData.json FactoryData.backup.json
2. Run: python scripts/migrate_factory_data.py --add-event-rules
3. Verify: python scripts/validate_factory_data.py

For more details, see Section 19 in documentation.
Engine startup aborted.
```

#### ì½”ë“œ êµ¬í˜„

```python
# engine/__init__.py

class BirthTimeEngine:
    def __init__(self, factory_data_path='FactoryData.json'):
        with open(factory_data_path, 'r') as f:
            self.factory_data = json.load(f)
        
        # Breaking Change ê²€ì¦
        if 'event_rules' not in self.factory_data:
            raise RuntimeError(
                "FactoryData migration incomplete\n"
                "Missing required section: 'event_rules'\n\n"
                "This is a breaking change. To fix:\n"
                "1. Backup: cp FactoryData.json FactoryData.backup.json\n"
                "2. Run: python scripts/migrate_factory_data.py --add-event-rules\n"
                "3. Verify: python scripts/validate_factory_data.py\n\n"
                "For more details, see Section 19 in documentation.\n"
                "Engine startup aborted."
            )
```

---

## 20. ê°œë°œíŒ€ ì „ë‹¬ì‚¬í•­

### 20.1 í•µì‹¬ ë©”ì‹œì§€

1. **ë¡œê·¸ í•¨ìˆ˜ëŠ” í•­ìƒ ìì—°ë¡œê·¸(ln)**
   - `math.log(x)` ì‚¬ìš© (base e)
   - `math.log10(x)` ì‚¬ìš© ê¸ˆì§€

2. **Event RulesëŠ” FactoryData.jsonì—ì„œ ê´€ë¦¬**
   - ì½”ë“œì— í•˜ë“œì½”ë”© ê¸ˆì§€
   - ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ í•„ìˆ˜ ì‹¤í–‰

3. **Fallback ì‹œìŠ¤í…œì€ ì ì§„ì  ì™„í™”**
   - Level 0 â†’ 1 â†’ 2 â†’ 3 â†’ 4 ìˆœì„œ ì—„ìˆ˜
   - Confidence Penalty í•„ìˆ˜ ì ìš©

4. **ê°œì¸ì •ë³´ ë³´í˜¸ ìµœìš°ì„ **
   - IP ì£¼ì†Œ ìˆ˜ì§‘ ê¸ˆì§€
   - `birth_place_coords` ê¸ˆì§€
   - ìë™ ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸ í™œì„±í™”

5. **Breaking Changes ëŒ€ì‘**
   - ì—”ì§„ ì‹œì‘ ì‹œ FactoryData ê²€ì¦
   - ì—ëŸ¬ ë©”ì‹œì§€ì— í•´ê²° ë°©ë²• í¬í•¨

### 20.2 êµ¬í˜„ ìš°ì„ ìˆœìœ„

**High Priority (ì¦‰ì‹œ)**:
1. FactoryData ë§ˆì´ê·¸ë ˆì´ì…˜
2. ë¡œê·¸ í•¨ìˆ˜ ì½”ë“œ ê²€í†  (log â†’ ln)
3. GDPR UI êµ¬í˜„ (JavaScript ê²€ì¦ í¬í•¨)
4. Breaking Changes ì—ëŸ¬ ë©”ì‹œì§€ ì¶”ê°€

**Medium Priority (Phase 2)**:
1. Antardasha ê³„ì‚°
2. Context-Aware Mapping
3. weight_range ì„¸ë°€ ì¡°ì •
4. ë²¤ì¹˜ë§ˆí¬ ìŠ¤í¬ë¦½íŠ¸

**Low Priority (Phase 2.5 ì´í›„)**:
1. Q13 ê°€ì¤‘ì¹˜ ìƒí–¥ ê²€í† 
2. í˜ë„í‹° ê°€ë³€í™” A/B í…ŒìŠ¤íŠ¸
3. CI/CD ìë™í™”

### 20.3 ì½”ë“œ ë¦¬ë·° ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `math.log()` ì‚¬ìš© (log10 ì•„ë‹˜)
- [ ] Event Rules JSONì—ì„œ ì½ê¸° (í•˜ë“œì½”ë”© ì—†ìŒ)
- [ ] Fallback ë ˆë²¨ ìˆœì„œ ì¤€ìˆ˜
- [ ] `birth_place_coords` ì ‘ê·¼ ì—†ìŒ
- [ ] IP ì£¼ì†Œ ë¡œê¹… ì—†ìŒ
- [ ] GDPR ë™ì˜ ê²€ì¦
- [ ] ì—ëŸ¬ ë©”ì‹œì§€ì— í•´ê²° ë°©ë²• í¬í•¨

---

## 21. êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 21.1 Phase 1 ì²´í¬ë¦¬ìŠ¤íŠ¸

**í‘œë³¸ ìƒì„±**:
- [ ] Coarse Scan (5ë¶„ ê°„ê²©)
- [ ] Cusp ê°ì§€
- [ ] Fine Scan (1ë¶„ ê°„ê²©)
- [ ] í‘œë³¸ ìºì‹±

**ì§ˆë¬¸ ì‹œìŠ¤í…œ**:
- [ ] ì ì‘í˜• ì§ˆë¬¸ ë¶„ê¸° (IG ê¸°ë°˜)
- [ ] Q1-Q8 ì„±í–¥ ì§ˆë¬¸
- [ ] Q9-Q13 ì‚¬ê±´ ì§ˆë¬¸
- [ ] Q14-Q15 Tiebreaker

**ìŠ¤ì½”ì–´ë§**:
- [ ] Feature Mapping (Static)
- [ ] ln í•¨ìˆ˜ ì‚¬ìš©
- [ ] ì²´ê°íš¨ìš© í•¨ìˆ˜
- [ ] ìŠ¤ì½”ì–´ ì •ê·œí™”

**ì‚¬ê±´ ê²€ì¦**:
- [ ] Event Rules JSON ë¡œë“œ
- [ ] Mahadasha ê³„ì‚°
- [ ] Fallback ì‹œìŠ¤í…œ (4ë‹¨ê³„)
- [ ] ë¡œê·¸í•© ì§‘ê³„

**ë„ìˆ˜ ì¶”ì •**:
- [ ] Circular Mean
- [ ] Cusp ê°ì§€ + Tiebreaker

**ì‹ ë¢°ë„**:
- [ ] ë“±ê¸‰ íŒì • (A+~C-)
- [ ] Fallback Penalty ì ìš©

**UX**:
- [ ] GDPR ë™ì˜ í™”ë©´
- [ ] ì§ˆë¬¸ UI
- [ ] ê²°ê³¼ í™”ë©´
- [ ] í”¼ë“œë°± ìˆ˜ì§‘

**ë¡œê¹…**:
- [ ] ì„¸ì…˜ ë¡œê·¸ JSON
- [ ] ê°œì¸ì •ë³´ ìë™ ì œê±°
- [ ] 24ì‹œê°„ ë³´ê´€ ì •ì±…

**ë°ì´í„°**:
- [ ] FactoryData ë§ˆì´ê·¸ë ˆì´ì…˜
- [ ] Event Rules JSON
- [ ] ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸

### 21.2 Phase 2 ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Antardasha ê³„ì‚°
- [ ] Context-Aware Mapping
- [ ] weight_range ì¡°ì •
- [ ] ë²¤ì¹˜ë§ˆí¬ ë¹„êµ

### 21.3 Phase 3 ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] ML ëª¨ë¸ êµ¬ì¶•
- [ ] ê°€ì¤‘ì¹˜ í•™ìŠµ
- [ ] ëŒ€ê·œëª¨ ë°ì´í„°ì…‹
- [ ] A/B í…ŒìŠ¤íŠ¸

---

## 22. í…ŒìŠ¤íŠ¸ ì „ëµ

### 22.1 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

```python
# tests/test_scoring.py

import pytest
from engine.scoring import calculate_score, ln

def test_ln_function():
    assert ln(1) == 0
    assert ln(2.718281828) â‰ˆ 1.0
    
def test_scoring():
    features = {"Q1_A": 8, "Q2_B": 5}
    score = calculate_score(features)
    assert score > 0
```

### 22.2 í†µí•© í…ŒìŠ¤íŠ¸

```python
# tests/test_pipeline.py

def test_full_pipeline():
    engine = BirthTimeEngine()
    result = engine.estimate(
        birth_date="1994-12-18",
        birth_city="Seoul",
        time_range=("13:00", "16:00"),
        questions={"Q1": "A", "Q9": {"option": "A", "year": 2014}}
    )
    
    assert result['asc_sign'] in ZODIAC_SIGNS
    assert result['confidence_grade'] in ['A+', 'A', 'B', 'C']
```

### 22.3 í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ í™•ì¥ (test_cases.json)

```json
{
  "test_cases": [
    {
      "case_id": "TC001",
      "description": "ì •ìƒ ì¼€ì´ìŠ¤: Antardasha ì •í™• ë§¤ì¹­",
      "birth_date": "1994-12-18",
      "birth_city": "Seoul",
      "time_range": "13:00-16:00",
      "questions": {
        "Q1": "A",
        "Q2": "B",
        "Q3": "A",
        "Q9": {"option": "A", "year": 2014},
        "Q10": {"option": "A", "year": 2016},
        "Q11": {"option": "A", "year": 2018},
        "Q12": {"option": "B", "year": 2019},
        "Q13": {"option": "A", "year": 2023, "month": 6}
      },
      "expected_asc": "Virgo",
      "expected_confidence": "A-",
      "expected_fallback": null
    },
    {
      "case_id": "TC002",
      "description": "Fallback ì¼€ì´ìŠ¤: Buffer í™•ì¥ í•„ìš”",
      "birth_date": "1990-03-15",
      "birth_city": "Busan",
      "time_range": "09:00-12:00",
      "questions": {
        "Q1": "C",
        "Q2": "D",
        "Q3": "D",
        "Q9": {"option": "B", "year": 2010},
        "Q10": {"option": "B", "year": 2012},
        "Q11": {"option": "D", "year": 2015},
        "Q12": {"option": "D", "year": 2018},
        "Q13": {"option": "B", "year": 2022}
      },
      "expected_asc": "Cancer",
      "expected_confidence": "B",
      "expected_fallback": "buffer_extended",
      "notes": "Q10 ì—°ë„ê°€ Antardashaì™€ 7ê°œì›” ì°¨ì´ â†’ Level 1 Fallback íŠ¸ë¦¬ê±° ì˜ˆìƒ"
    },
    {
      "case_id": "TC003",
      "description": "Cusp ì¼€ì´ìŠ¤: Tiebreaker í•„ìš”",
      "birth_date": "1988-07-22",
      "birth_city": "Incheon",
      "time_range": "17:30-20:30",
      "questions": {
        "Q1": "A",
        "Q2": "A",
        "Q3": "A",
        "Q9": {"option": "A", "year": 2008},
        "Q10": {"option": "A", "year": 2010},
        "Q11": {"option": "A", "year": 2015},
        "Q12": {"option": "A", "year": 2018},
        "Q13": {"option": "A", "year": 2023}
      },
      "expected_asc": "Sagittarius",
      "expected_confidence": "B+",
      "expected_tiebreaker": true,
      "notes": "Leo/Virgo ê²½ê³„ â†’ Q14-Q15 Tiebreaker ì¶œì œ ì˜ˆìƒ"
    }
  ]
}
```

### 22.4 ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

```python
# tests/test_performance.py

import time

def test_pipeline_performance():
    engine = BirthTimeEngine()
    
    start = time.time()
    result = engine.estimate(...)
    end = time.time()
    
    assert (end - start) < 6.0  # 6ì´ˆ ì´ë‚´
```

---

## 23. ë³´ì•ˆ ë° ê°œì¸ì •ë³´ ë³´í˜¸

### 23.1 GDPR ì¤€ìˆ˜

- ëª…ì‹œì  ë™ì˜ ìˆ˜ì§‘
- ë°ì´í„° ìµœì†Œ ìˆ˜ì§‘
- 24ì‹œê°„ í›„ ìë™ ì‚­ì œ
- ì‚¬ìš©ì ë°ì´í„° ì ‘ê·¼ ê¶Œí•œ
- ë°ì´í„° ì‚­ì œ ìš”ì²­ ì²˜ë¦¬

### 23.2 ê¸ˆì§€ í•„ë“œ ëª©ë¡

ì ˆëŒ€ ìˆ˜ì§‘/ì €ì¥í•˜ì§€ ì•ŠëŠ” ì •ë³´:

```python
FORBIDDEN_FIELDS = [
    'ip_address',              # IP ì£¼ì†Œ
    'birth_place_coords',      # ìœ„ë„/ê²½ë„
    'device_id',               # ê¸°ê¸° ì‹ë³„ì
    'mac_address',             # MAC ì£¼ì†Œ
    'email',                   # ì´ë©”ì¼ (ìµëª…í™” í•„ìˆ˜)
    'phone_number',            # ì „í™”ë²ˆí˜¸
    'precise_location'         # ì •ë°€ ìœ„ì¹˜
]
```

### 23.3 ìë™ ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸

```python
# utils/privacy.py

def validate_no_forbidden_fields(data, forbidden_fields):
    for field in forbidden_fields:
        if field in data:
            raise ValueError(
                f"Forbidden field detected: {field}\n"
                f"This violates GDPR/privacy policy.\n"
                f"Remove this field before proceeding."
            )

# ë¡œê¹… ì‹œ ìë™ í˜¸ì¶œ
def log_session(session_data):
    validate_no_forbidden_fields(session_data, FORBIDDEN_FIELDS)
    # ... ë¡œê¹… ì§„í–‰
```

### 23.4 birth_place_coords ê¸ˆì§€ ì´ìœ 

**ìœ„ì¹˜ ì¶”ì  ë¦¬ìŠ¤í¬**:
- ì¶œìƒ êµ­ê°€("KR")ëŠ” ê°œì¸ íŠ¹ì • ë¶ˆê°€
- ìœ„ë„/ê²½ë„ëŠ” ì¶œìƒ ë³‘ì›/ì§‘ ì£¼ì†Œ ì—­ì¶”ì  ê°€ëŠ¥
- ì‘ì€ ë„ì‹œì—ì„œëŠ” ì¢Œí‘œë§Œìœ¼ë¡œ ê±°ì˜ íŠ¹ì •ë¨

**ë²•ì  ê·¼ê±°**:
- GDPR: "ê°œì¸ ì‹ë³„ ì •ë³´" ì •ì˜ì— í•´ë‹¹
- í•œêµ­ ê°œì¸ì •ë³´ ë³´í˜¸ë²•: "ìœ„ì¹˜ì •ë³´"ëŠ” ë¯¼ê°ì •ë³´

**ëŒ€ì•ˆ**:
- ë„ì‹œëª…("Seoul") â†’ êµ­ê°€ ì½”ë“œ("KR")ë¡œë§Œ ë³€í™˜
- ephemeris ê³„ì‚°ìš© ì¢Œí‘œëŠ” ì„ì‹œ ë©”ëª¨ë¦¬ì—ë§Œ ë³´ê´€
- ë¡œê·¸ì— ì ˆëŒ€ ê¸°ë¡í•˜ì§€ ì•ŠìŒ

### 23.5 ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] GDPR ë™ì˜ í™”ë©´ êµ¬í˜„
- [ ] ê¸ˆì§€ í•„ë“œ ìë™ ê²€ì¦
- [ ] IP ì£¼ì†Œ ìˆ˜ì§‘ ê¸ˆì§€
- [ ] birth_place_coords ì ‘ê·¼ ê¸ˆì§€
- [ ] ë¡œê·¸ 24ì‹œê°„ ë³´ê´€ ì •ì±…
- [ ] CSRF í† í° ê²€ì¦
- [ ] HTTPS í†µì‹  í•„ìˆ˜

---

## 24. ë¶€ë¡

### 24.1 ìˆ˜í•™ ë° í†µê³„

- [Natural Logarithm (Wikipedia)](https://en.wikipedia.org/wiki/Natural_logarithm)
- [Softmax Function (DeepAI)](https://deepai.org/machine-learning-glossary-and-terms/softmax-layer)
- [Gradient Descent Optimization](https://arxiv.org/abs/1609.04747)
- [Circular Mean (Wikipedia)](https://en.wikipedia.org/wiki/Circular_mean)

### 24.2 GDPR ë° ê°œì¸ì •ë³´ ë³´í˜¸

- [GDPR ê³µì‹ ë¬¸ì„œ](https://gdpr.eu)
- [ê°œì¸ì •ë³´ ë³´í˜¸ë²• (í•œêµ­)](https://www.privacy.go.kr)
- [GDPR Consent UI Examples](https://gdpr.eu/consent-examples/)
- [ìœ„ì¹˜ì •ë³´ì˜ ë³´í˜¸ ë° ì´ìš© ë“±ì— ê´€í•œ ë²•ë¥ ](https://www.law.go.kr)

### 24.3 ë² ë”• ì ì„±í•™

- [Vimshottari Dasha Calculator](https://www.astrosage.com/dasha/)
- [Nakshatra Guide](https://www.vedicastrology.us.com/nakshatras.html)
- [Karaka Planet Significations](https://www.astro.com/astrology/in_karaka_e.htm)
- [Vedic Astrology Basics](https://www.vedicastrologybasics.com)

### 24.4 ì†Œí”„íŠ¸ì›¨ì–´ ì—”ì§€ë‹ˆì–´ë§

- [Semantic Versioning](https://semver.org/)
- [Migration Best Practices](https://docs.microsoft.com/en-us/ef/core/managing-schemas/migrations/)
- [API Backward Compatibility](https://swagger.io/docs/specification/versioning/)
- [Python Logging Best Practices](https://docs.python.org/3/howto/logging.html)

### 24.5 ì¶”ê°€ ì°¸ê³  ìë£Œ

- [LogSumExp Trick](https://en.wikipedia.org/wiki/LogSumExp)
- [Information Gain (Entropy)](https://en.wikipedia.org/wiki/Information_gain_in_decision_trees)
- [A/B Testing Guide](https://www.optimizely.com/optimization-glossary/ab-testing/)

---

## ë¬¸ì„œ ì¢…ë£Œ

**ìµœì¢… ì‘ì„±ì¼**: 2026-02-09  
**ìŠ¹ì¸ì**: [ê°œë°œ ì´ì±…ì„ì]  
**ë‹¤ìŒ ì—…ë°ì´íŠ¸**: Phase 2 ì™„ë£Œ í›„ ì•ˆì •í™” ë° ë²„ê·¸ í”½ìŠ¤

---

**Key Takeaways**:

1. **ë¡œê·¸ í•¨ìˆ˜ëŠ” í•­ìƒ ìì—°ë¡œê·¸(ln)** - ML í‘œì¤€, Gradient ì•ˆì •ì„±
2. **Event RulesëŠ” JSON ë°ì´í„°** - ìœ ì—°ì„±, ML ì¤€ë¹„
3. **Fallbackì€ 4ë‹¨ê³„ ì ì‘í˜•** - ì ì§„ì  ì™„í™”, Confidence Penalty
4. **ê°œì¸ì •ë³´ ë³´í˜¸ ìµœìš°ì„ ** - IP ê¸ˆì§€, birth_place_coords ê¸ˆì§€
5. **Breaking Changes ëŒ€ì‘ í•„ìˆ˜** - ë§ˆì´ê·¸ë ˆì´ì…˜ + ê²€ì¦ + ì—ëŸ¬ ë©”ì‹œì§€

---

**ë¬¸ì„œ ë**
